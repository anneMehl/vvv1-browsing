---
title: "09_total_path_effect"
author: "anne"
date: "29 august 2019"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



## Load data and models
```{r}
load("processdata/browse9.4.rda")
load("processdata/browse9.4_house.rda")
```

```{r}
library(lme4)
library(glmmTMB)
```


## Browsing pressure
#### Houses
```{r}
load(paste0(getwd(), "/browsing_pressure_data_models/house_data_models/m1kbin2.rda"))
zeromod1 <- m1kbin2

load(paste0(getwd(), "/browsing_pressure_data_models/house_data_models/m1ibeta2.rda"))
percmod1 <- m1ibeta2

load(paste0(getwd(), "/browsing_pressure_data_models/house_data_models/browse9.4_house.rda"))
dat1 <- browse9.4_house
```

#### Roads
```{r}
load(paste0(getwd(), "/browsing_pressure_data_models/m4abin2.rda"))
zeromod1 <- m4abin2
# summary(zeromod1)

load(paste0(getwd(), "/browsing_pressure_data_models/m4abeta2.rda"))
percmod1 <- m4abeta2 
# summary(percmod1)

load(paste0(getwd(), "/browsing_pressure_data_models/browse9.4.rda"))
# head(browse9.4)
dat1 <- browse9.4
```



## Recruits
#### Houses
```{r}
load(paste0(getwd(), "/prop_large_trees_data_models/house_data_models/browse9.5msc.rda"))
dat2 <- browse9.5msc

load(paste0(getwd(), "/prop_large_trees_data_models/house_data_models/mhusabin.rda"))
zeromod2 <- mhusabin

load(paste0(getwd(), "/prop_large_trees_data_models/house_data_models/m16abeta.rda"))
percmod2 <- m16abeta
```

#### Roads
```{r}
load(paste0(getwd(), "/prop_large_trees_data_models/m16cbin.rda"))
zeromod2 <- m16cbin
# summary(zeromod2)

load(paste0(getwd(), "/prop_large_trees_data_models/m16abeta.rda"))
percmod2 <- m16abeta
# summary(percmod2)

load(paste0(getwd(), "/prop_large_trees_data_models/browse9.6sc.rda"))
# head(browse9.6sc)
dat2 <- browse9.6sc
```




## Load and run function
```{r}
source("function_resp_curve.R")
```

```{r}
(focal = c("distvei", "skogkategori", "treartgruppe", "kant", 
           "helling", "HOH", "tretetthet", "browspres_merged", "disthus")[9])
(focal = c("distvei", "skogkategori", "treartgruppe", "kant", 
           "helling", "HOH", "tretetthet", "browspres_merged", "disthus")[9])
```

#### Run function for the different models/ focals and SAVE them
```{r}
resp_curve(focal, dat1, dat2, zeromod1, percmod1, zeromod2, percmod2, 
           which_effect=c("hurdle1_only", "hurdle2_only", "total")[1], nvals=100, plotit=T, nb_btstrp=99)

resp_curve(focal, dat1, dat2, zeromod1, percmod1, zeromod2, percmod2, 
           which_effect=c("hurdle1_only", "hurdle2_only", "total")[2], nvals=100, plotit=T, nb_btstrp=99)

resp_curve(focal, dat1, dat2, zeromod1, percmod1, zeromod2, percmod2, 
           which_effect=c("hurdle1_only", "hurdle2_only", "total")[3], nvals=100, plotit=T, nb_btstrp=99)
```
#### Save function data!
```{r}
save(hurdle_disthus2, file = "hurdle_disthus2.rda")


```




## load function data
```{r}
load("output/hurdle_disthus2.rda")
load("output/hurdle_distvei.rda")
load("output/hurdle_skogkat.rda")
load("output/hurdle_kant.rda")
load("output/hurdle_treart.rda")
load("output/hurdle_hell.rda")
load("output/hurdle_hoh.rda")
load("output/hurdle_tretett.rda")

load("output/total_disthus.rda")
load("output/total_distvei.rda")
load("output/total_skogkat.rda")
load("output/total_kant.rda")
load("output/total_treart.rda")
load("output/total_hell.rda")

load("output/direct_disthus.rda")
load("output/direct_distvei.rda")
load("output/direct_skogkat.rda")
load("output/direct_kant.rda")
load("output/direct_treart.rda")
load("output/direct_hell.rda")
load("output/direct_beite.rda")


```


## Re-scale
```{r}
# attributes(browse9.2$HOH_scale)
# attributes(browse9.2$disthus_trunc_cut200_scale)
# 
# d$s.x * attr(d$s.x, 'scaled:scale') + attr(d$s.x, 'scaled:center')


h1_disthus$var <- h1_disthus$var * 27.71453 + 192.2636
h1_distvei$var <- exp(h1_distvei$var)-1
h1_hoh$var <- h1_hoh$var * 244.7748 + 361.8423


h2_distvei$var <- exp(h2_distvei$var)-1
```





## Plots
```{r}
library(ggplot2)

pt_disthus <- ggplot() + 
  geom_line(data = total_disthus2, aes(var, point, color = "total"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_disthus2, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  geom_line(data = direct_disthus, aes(var, point, color = "direct"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = direct_disthus, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nDistance to house (m)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

ph_disthus <- ggplot(data = hurdle_disthus2, aes(var, point)) +
  geom_line(colour = "#009292", linetype = 1, size = 1)+
  geom_ribbon(aes(ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nDistance to house (m)") + 
  ylab("Browsing pressure (%)\n") +
  scale_y_continuous(limits = c(10, 30), breaks =  seq(from = 10, to = 30, by = 5))

pt_distvei <- ggplot() + 
  geom_line(data = total_distvei, aes(var, point, color = "total"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_distvei, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  geom_line(data = direct_distvei, aes(var, point, color = "direct"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = direct_distvei, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nDistance to road (m)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

ph_distvei <- ggplot(data = hurdle_distvei, aes(var, point)) +
  geom_line(colour = "#009292", linetype = 1, size = 1)+
  geom_ribbon(aes(ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nDistance to road (m)") + 
  ylab("Browsing pressure (%)\n") +
  scale_y_continuous(limits = c(10, 30), breaks =  seq(from = 10, to = 30, by = 5))


pt_skogkat <- ggplot() +
  geom_pointrange(data = total_skogkat, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "total"), size = 1) +
  geom_pointrange(data = direct_skogkat, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "direct"), size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nForest category") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Highproductive \nold forest", "Highproductive \nyoung forest", "Lowproductive \nold forest", "Lowproductive \nyoung forest", "Unproductive \nforest"))+
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

ph_skogkat <- ggplot(data = hurdle_skogkat,aes(var, point)) +
  geom_pointrange(aes(ymin = CI025, ymax = CI975), colour = "#009292", size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nForest category") + 
  ylab("Browsing pressure (%)\n") +
  scale_x_discrete(labels = c("Highproductive \nold forest", "Highproductive \nyoung forest", "Lowproductive \nold forest", "Lowproductive \nyoung forest", "Unproductive \nforest"))+
  scale_y_continuous(limits = c(5, 50), breaks =  seq(from = 5, to = 50, by = 10))


pt_treart <- ggplot() +
  geom_pointrange(data = total_treart, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "total"), size = 1) +
  geom_pointrange(data = direct_treart, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "direct"), size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nTree species group") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Pine", "Other deciduous \ntrees", "Rowan, aspen, \nwillow")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

ph_treart <- ggplot(data = hurdle_treart,aes(var, point)) +
  geom_pointrange(aes(ymin = CI025, ymax = CI975), colour = "#009292", size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nTree species groups") + 
  ylab("Browsing pressure (%)\n") +
  scale_x_discrete(labels = c("Pine", "Other deciduous \ntrees", "Rowan, aspen, \nwillow")) +
  scale_y_continuous(limits = c(5, 50), breaks =  seq(from = 5, to = 50, by = 10))


pt_kant <- ggplot() +
  geom_pointrange(data = total_kant, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "total"), size = 1) +
  geom_pointrange(data = direct_kant, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "direct"), size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nEdge effect") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Edge <10m", "Edge >20m", "Edge 10-10m", "Edge information\nmissing")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

ph_kant <- ggplot(data = hurdle_kant, aes(var, point)) +
  geom_pointrange(aes(ymin = CI025, ymax = CI975), colour = "#009292", size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nEdge effect") + 
  ylab("Browsing pressure (%)\n") +
  scale_x_discrete(labels = c("Edge <10m", "Edge >20m", "Edge 10-10m", "Edge information\nmissing"))+
  scale_y_continuous(limits = c(5, 50), breaks =  seq(from = 5, to = 50, by = 10))


pt_hell <- ggplot() + 
  geom_line(data = total_hell, aes(var, point, color = "total"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_hell, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  geom_line(data = direct_hell, aes(var, point, color = "direct"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = direct_hell, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nSlope (%)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

ph_hell <- ggplot(data = hurdle_hell,aes(var, point)) +
  geom_line(colour = "#009292", linetype = 1, size = 1)+
  geom_ribbon(aes(ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nSlope (%)") + 
  ylab("Browsing pressure (%)\n")+
  scale_y_continuous(limits = c(10, 30), breaks =  seq(from = 10, to = 30, by = 5))


ph_hoh <- ggplot(data = hurdle_hoh,aes(var, point)) +
  geom_line(colour = "#009292", linetype = 1, size = 1)+
  geom_ribbon(aes(ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nAltitude (m)") + 
  ylab("Browsing pressure (%)\n")+
  scale_y_continuous(limits = c(10, 30), breaks =  seq(from = 10, to = 30, by = 5))


ph_tretett <- ggplot(data = hurdle_tretett,aes(var, point)) +
  geom_line(colour = "#009292", linetype = 1, size = 1)+
  geom_ribbon(aes (ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nTree density") + 
  ylab("Browsing pressure (%)\n")+
  scale_y_continuous(limits = c(10, 30), breaks =  seq(from = 10, to = 30, by = 5))


pt_beite <- ggplot() + 
  geom_line(data = direct_beite, aes(var, point, color = "direct"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = direct_beite, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nbrowsing pressure (%)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))
# library(cowplot)
# plot_grid(p1, p2, p3, p4, p5, p6, p7, p8,
#           nrow = 3, ncol = 3)

library(gridExtra)
grid.arrange(ph_tretett, ph_disthus, ph_distvei, ph_hell, ph_hoh, ph_kant, ph_skogkat, ph_treart,
          nrow = 3, ncol = 3)

grid.arrange(pt_disthus, pt_distvei, pt_hell, pt_kant, pt_skogkat, pt_treart, pt_beite,
          nrow = 3, ncol = 3)


```

"#004949", "#009292"
