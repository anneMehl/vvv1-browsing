---
title: "01_cleaning_data_browse_vers2"
author: "anne"
date: "20 desember 2019"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



## For browse9.5 (tree height classes, not tree density)

```{r}
load("processdata/browse9.5.rda")
load("rawdata/browse0.1.rda")
```

##### Subsetting on 9th and 10th cycle
```{r}
browse0.1_910 <- split(browse0.1, browse0.1$takst)

browse9.1 <- browse0.1_910[['9']]
summary(browse9.1)

# save(browse9.1, file = "browse9.1.rda")
load("processdata/browse9.1.rda")
load("processdata/browse9.5.rda")

browse9.1 <- browse9.1[,c(1:5,7:9,15:24,34:36,40:45,51,59,62:67,74,76:79,88:90,99:105,112:115)]

# browse9.2$x <- NULL


browse9.5 <- browse9.1
browse9.5 <- browse9.5[,c(1:3,5:8,19:24,36,41:43,48,50:54)]
browse9.5 <- subset(browse9.5, select = -c(27:32,34:36))


save(browse9.5, file = "browse9.5.rda")

```

##### Explore NAs 
```{r}

nrow(browse9.5)
nrow(na.omit(browse9.5))

sum(is.na(browse9.5$beitetrykk9))
sum(is.na(browse9.5$tretetthet9))

summary(browse9.5)

browse9.5$distvei2[is.na(browse9.5$distvei2)] <- 2218
browse9.5$disthus[is.na(browse9.5$disthus)] <- 3000

browse9.5 <- na.omit(browse9.5)


# save(browse9.5, file = "browse9.5.rda")
load("processdata/browse9.5.rda")
load("processdata/browse9.5msc.rda")


# browse9.5$FLATEID <- as.factor(browse9.5$FLATEID)
# str(levels(browse9.5$FLATEID)) 
# unique(browse9.5$FLATEID)
# 
browse9.5m$FLATEID <- as.factor(browse9.5m$FLATEID)
str(levels(browse9.5m$FLATEID))
unique(browse9.5m$FLATEID)

```


```{r}
library(ggplot2)

ggplot(data = browse9.5, aes(skogkategori)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9.5, aes(kant)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9.5m, aes(treartgruppe9)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9.5, aes(region)) +
  geom_bar()+
  theme_classic()


```


```{r}

browse9.5$skogkategori <- factor(browse9.5$skogkategori, levels = c("Lavproduktiv_eldreskog", "Høyproduktiv_eldreskog", "Høyproduktiv_ungskog",  "Lavproduktiv_ungskog", "Uproduktiv_skog"))
browse9.5$kant <- factor(browse9.5$kant, levels = c("kant >20m", "kant <10m", "kant 10-20m", "mangler kant")) 
browse9.5$treartgruppe9 <- factor(browse9.5$treartgruppe9, levels = c("LAUV", "FURU"))

browse9.5$region <- factor(browse9.5$region, levels = c("Hedmark", "Agder", "Buskerud", "Hordaland",  "More og Romsdal", "Nord-Trondelag", "Nordland", "Oppland", "Ostfold-Akershus", "Rogaland", "Sogn og Fjordane", "Sor-Trondelag", "Troms", "Vestfold-Telemark"))



```

```{r}

browse9.5$beitetrykkr <- as.integer(round(browse9.5$beitetrykk9))
browse9.5$bt100 <- browse9.5$beitetrykkr/100
```

```{r}
save(browse9.5, file = "browse9.5.rda")

save(browse9.6, file = "browse9.6.rda")
```


##### Subsets and new variable(s)
```{r}

## Creating new variable proportion large trees "proplt" and on the way also "browsed merged"
load("processdata/browse9.5.rda")
browse9.5 <- as.data.frame(browse9.5)

tmp1 <- browse9.5[browse9.5$treartgruppe9 == "FURU", ]
tmp2 <- browse9.5[browse9.5$treartgruppe9 == "LAUV", ]
tmp3 <- browse9.5[browse9.5$treartgruppe9 == "ROS", ]
browse9.5m <-  browse9.5[browse9.5$treartgruppe9 != "FURU", ]
browse9.5m <-  browse9.5m[!duplicated(browse9.5m$FLATEID), ]
browse9.5m$treartgruppe9 <-  "LAUV"
browse9.5m <- rbind(browse9.5m, tmp1)
browse9.5m$rosTD <- tmp3$tretetthet9[match(browse9.5m$FLATEID, tmp3$FLATEID)]
browse9.5m$rosBP <- tmp3$beitetrykkr [match(browse9.5m$FLATEID, tmp3$FLATEID)]
browse9.5m$lauvTD <- tmp2$tretetthet9[match(browse9.5m$FLATEID, tmp2$FLATEID)]
browse9.5m$lauvBP <- tmp2$beitetrykkr [match(browse9.5m$FLATEID, tmp2$FLATEID)]

browse9.5m$rosTD <- ifelse(is.na(browse9.5m$rosTD), 0, browse9.5m$rosTD)
browse9.5m$rosBP <- ifelse(is.na(browse9.5m$rosBP), 0, browse9.5m$rosBP)
browse9.5m$lauvTD <- ifelse(is.na(browse9.5m$lauvTD), 0, browse9.5m$lauvTD)
browse9.5m$lauvBP <- ifelse(is.na(browse9.5m$lauvBP), 0, browse9.5m$lauvBP)
  
browse9.5m$browspres_merged <- browse9.5m$beitetrykkr
browse9.5m$browspres_merged[browse9.5m$treartgruppe9 == "LAUV"] <- (browse9.5m$lauvTD[browse9.5m$treartgruppe9 == "LAUV"] * browse9.5m$lauvBP[browse9.5m$treartgruppe9 == "LAUV"] + browse9.5m$rosTD[browse9.5m$treartgruppe9 == "LAUV"] * browse9.5m$rosBP[browse9.5m$treartgruppe9 == "LAUV"])/ (browse9.5m$lauvTD[browse9.5m$treartgruppe9 == "LAUV"] + browse9.5m$rosTD[browse9.5m$treartgruppe9 == "LAUV"])

browse9.5m$distvei2[is.na(browse9.5m$distvei2)] <- 2218
browse9.5m$disthus[is.na(browse9.5m$disthus)] <- 3000



nrow(browse9.5m)
nrow(na.omit(browse9.5m))

summary(browse9.5m)

sum(is.na(browse9.5m$beitetrykkr))


browse9.5m <- as.data.frame(browse9.5m)

browse9.5m <- browse9.5m[,c(1:24,29)]


browse9.5m$proplt <- ifelse(browse9.5m$treartgruppe9 == "FURU", 
                            (browse9.5m$Furu_0_25_PRHA + browse9.5m$Furu_25_49_PRHA)/(browse9.5m$Furu_0_PRHA + browse9.5m$Furu_0_25_PRHA + browse9.5m$Furu_25_49_PRHA), 
                            (browse9.5m$Lauv_0_25_PRHA + browse9.5m$Lauv_25_49_PRHA)/ (browse9.5m$Lauv_0_PRHA + browse9.5m$Lauv_0_25_PRHA + browse9.5m$Lauv_25_49_PRHA))


nrow(browse9.5m)
nrow(na.omit(browse9.5m))

browse9.5m <- na.omit(browse9.5m)


browse9.5msc <- browse9.5msc[,c(1,3,7,15:17,19:20,25:26,33,40)]
save(browse9.5msc, file = "browse9.5msc.rda")


# Subset on different cuts for disthus
browse9.6 <- browse9.5m[ which(browse9.5m$disthus > 400), ]
save(browse9.6, file = "browse9.6.rda")

# browse9.7pos <- browse9.6pos[ which(browse9.6pos$disthus > 200), ]
# save(browse9.7pos, file = "browse9.7pos.rda")



save(browse9.5, file = "browse9.5.rda")

save(browse9.5m, file = "browse9.5m.rda")



```

## TEST for difference between regions
```{r}
##### House
load("processdata/browse9.5msc.rda")
browse9.5m_region <- browse9.5m
browse9.5m_region <- browse9.5m_region[,c(1:3,7,14:20,25:26,33,40)]

pvars <- c("disthus_400", "HOH")
browse9.5m_regionsc <- browse9.5m_region
browse9.5m_regionsc[pvars] <- lapply(browse9.5m_regionsc[pvars],scale)

save(browse9.5m_regionsc, file = "browse9.5m_regionsc.rda")

## Subset municipalities ----
hedmark <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Hedmark", ]
agder <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Agder", ]
buskerud <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Buskerud", ]
hordaland <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Hordaland", ]
more_og_romsdal <- browse9.5m_regionsc[browse9.5m_regionsc$region == "More og Romsdal", ]
nord_trondelag <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Nord-Trondelag", ]
nordland <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Nordland", ]
oppland <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Oppland", ]
ostfold_akershus <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Ostfold-Akershus", ]
rogaland <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Rogaland", ]
sogn_og_fjordane <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Sogn og Fjordane", ]
sor_trondelag <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Sor-Trondelag", ]
troms <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Troms", ]
vestfold_telemark <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Vestfold-Telemark", ]



##### Road
load("processdata/browse9.6.rda")
browse9.6_region <- browse9.6
browse9.6_region <- browse9.6_region[,c(1:3,7,14:20,25:26,33,40)]

pvars <- c("HOH","ac" ) #  "helling", "browspres_merged", "ac" 
browse9.6_regionsc <- browse9.6_region
browse9.6_regionsc[pvars] <- lapply(browse9.6_regionsc[pvars],scale)

save(browse9.6_regionsc, file = "browse9.6_regionsc.rda")
```


## browse9.5m

##### threshold cuts disthus
```{r}
browse9.5m$disthus_1000 <- ifelse(browse9.5m$disthus >= 1000, 1000, browse9.5m$disthus)
# browse9.5m$disthus_cut950 <- ifelse(browse9.5m$disthus >= 950, 950, browse9.5m$disthus)
browse9.5m$disthus_900 <- ifelse(browse9.5m$disthus >= 900, 900, browse9.5m$disthus)
# browse9.5m$disthus_cut850 <- ifelse(browse9.5m$disthus >= 850, 850, browse9.5m$disthus)
browse9.5m$disthus_800 <- ifelse(browse9.5m$disthus >= 800, 800, browse9.5m$disthus)
# browse9.5m$disthus_cut750 <- ifelse(browse9.5m$disthus >= 750, 750, browse9.5m$disthus)
browse9.5m$disthus_700 <- ifelse(browse9.5m$disthus >= 700, 700, browse9.5m$disthus)
# browse9.5m$disthus_cut650 <- ifelse(browse9.5m$disthus >= 650, 650, browse9.5m$disthus)
browse9.5m$disthus_600 <- ifelse(browse9.5m$disthus >= 600, 600, browse9.5m$disthus)
browse9.5m$disthus_500 <- ifelse(browse9.5m$disthus >= 500, 500, browse9.5m$disthus)
browse9.5m$disthus_400 <- ifelse(browse9.5m$disthus >= 400, 400, browse9.5m$disthus)
browse9.5m$disthus_350 <- ifelse(browse9.5m$disthus >= 350, 350, browse9.5m$disthus)
browse9.5m$disthus_300 <- ifelse(browse9.5m$disthus >= 300, 300, browse9.5m$disthus)
browse9.5m$disthus_200 <- ifelse(browse9.5m$disthus >= 200, 200, browse9.5m$disthus)
# browse9.5m$disthus_150 <- ifelse(browse9.5m$disthus >= 150, 150, browse9.5m$disthus)
browse9.5m$disthus_175 <- ifelse(browse9.5m$disthus >= 175, 175, browse9.5m$disthus)
browse9.5m$disthus_160 <- ifelse(browse9.5m$disthus >= 160, 160, browse9.5m$disthus)
# browse9.5m$disthus_190 <- ifelse(browse9.5m$disthus >= 190, 190, browse9.5m$disthus)
# browse9.2$disthus_trunc_cut1000 <- ifelse(browse9.2$disthus_trunc >= 1000, 1000, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut900 <- ifelse(browse9.2$disthus_trunc >= 900, 900, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut800 <- ifelse(browse9.2$disthus_trunc >= 800, 800, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut700 <- ifelse(browse9.2$disthus_trunc >= 700, 700, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut600 <- ifelse(browse9.2$disthus_trunc >= 600, 600, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut500 <- ifelse(browse9.2$disthus_trunc >= 500, 500, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut400 <- ifelse(browse9.2$disthus_trunc >= 400, 400, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut300 <- ifelse(browse9.2$disthus_trunc >= 300, 300, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut200 <- ifelse(browse9.2$disthus_trunc >= 200, 200, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut150 <- ifelse(browse9.2$disthus_trunc >= 150, 150, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut175 <- ifelse(browse9.2$disthus_trunc >= 175, 175, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut160 <- ifelse(browse9.2$disthus_trunc >= 160, 160, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut190 <- ifelse(browse9.2$disthus_trunc >= 190, 190, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut100 <- ifelse(browse9.2$disthus_trunc >= 100, 100, browse9.2$disthus_trunc)

save(browse9.5m, file = "browse9.5m.rda")
```





## Add moose density (mean over 5 year period to datasets and models)
```{r}
library(readr)
moose_mean_density <- read_csv("processdata_copy/five_y_mean_density.csv", na = "NA")
str(moose_mean_density)
library(tidyverse)
moose_mean_density <- moose_mean_density %>%
  rename(KOMNR = knr2017) %>%
  rename(moose_density = five_y_mean_density)
str(moose_mean_density)

```

#### Recruits house
```{r}
## HOUSE
load("processdata_copy/browse9.5msc.rda")
browse9.5msc_test <- left_join(browse9.5msc, moose_mean_density, by = "KOMNR")
str(browse9.5msc_test$moose_density)
sum(is.na(browse9.5msc_test$moose_density))
which(is.na(browse9.5msc_test$moose_density))
browse9.5msc_test[2254, ]
browse9.5msc_test[2257, ]
browse9.5msc_test$moose_density <- ifelse(is.na(browse9.5msc_test$moose_density), 0, browse9.5msc_test$moose_density)
sum(is.na(browse9.5msc_test$moose_density))

# browse9.5msc_test_pos <- browse9.5msc_test[browse9.5msc_test$bt100 > 0, ]
# sum(is.na(browse9.5msc_test_pos))

load("processdata_copy/browse9.5mpossc.rda")
browse9.5msc_test_pos <- left_join(browse9.5mpossc, moose_mean_density, by = "KOMNR")
str(browse9.5msc_test_pos$moose_density)
sum(is.na(browse9.5msc_test_pos$moose_density))
browse9.5msc_test_pos$moose_density <- ifelse(is.na(browse9.5msc_test_pos$moose_density), 0, browse9.5msc_test_pos$moose_density)
sum(is.na(browse9.5msc_test_pos$moose_density))


library(lme4)
library(glmmTMB)


## BIN
load("output_copy/mhusabin.rda")
rh_bin <- glmer(factor(proplt > 0) ~ disthus_400 + log(distvei2+1) + skogkategori + treartgruppe9 + browspres_merged + kant + helling + HOH + I(HOH^2) +  ac + moose_density + (1|KOMNR),
family = binomial(),
data = browse9.5msc_test)

rh_bin_int <- glmer(factor(proplt > 0) ~ disthus_400 + log(distvei2+1) + skogkategori + treartgruppe9 + browspres_merged + kant + helling + HOH + I(HOH^2) +  ac + moose_density + moose_density*log(distvei2+1) + (1|KOMNR),
family = binomial(),
data = browse9.5msc_test)


library(AICcmodavg)
candmods_BP_hbin <- list(rh_bin, mhusabin, rh_bin_int)
aictab(candmods_BP_hbin, modnames = NULL,
                       second.ord = TRUE, nobs = NULL, sort = TRUE)
#       K     AICc Delta_AICc AICcWt Cum.Wt       LL
# Mod1 18 14206.75       0.00   0.70   0.70 -7085.35
# Mod3 19 14208.68       1.92   0.27   0.97 -7085.30
# Mod2 17 14213.08       6.33   0.03   1.00 -7089.51

summary(rh_bin) # moose density negative **


# library(sjPlot)
# library(ggplot2)
# p1 <- plot_model(bh_bin, type = c("eff"), transform = NULL, terms = c("moose_density"),
#            grid = TRUE)
# p1 <- p1 + theme_light() +
#   theme(plot.title = element_blank(),
#     axis.text = element_text(family = "sans", size = 20, color = "grey30"),
#         axis.title = element_text(family = "sans", size = 20, color = "grey30")) +
#   xlab("5 year mean moose density\n") +
#   ylab("Browsing pressure (%)\n")


## BETA
load("output_copy/m16abeta_house.rda")
rh_beta <- glmmTMB(proplt ~ log(distvei2+1) + skogkategori + treartgruppe9 + HOH + I(HOH^2) + browspres_merged + moose_density + (1|KOMNR),
            data = browse9.5msc_test_pos,
            family = beta_family())

rh_beta_int <- glmmTMB(proplt ~ log(distvei2+1) + skogkategori + treartgruppe9 + HOH + I(HOH^2) + browspres_merged + moose_density + moose_density*log(distvei2+1) + (1|KOMNR),
            data = browse9.5msc_test_pos,
            family = beta_family())


library(bbmle)
AIC(rh_beta, m16abeta_house, rh_beta_int)
ICtab(rh_beta, m16abeta_house, rh_beta_int, type = "AIC", weights = TRUE, delta = TRUE)

summary(rh_beta) # moose density not sign.

```


#### Recruits roads
```{r}
## ROADS
load("processdata_copy/browse9.6sc.rda")
browse9.6sc_test <- left_join(browse9.6sc, moose_mean_density, by = "KOMNR")
str(browse9.6sc_test$moose_density)
sum(is.na(browse9.6sc_test$moose_density))
which(is.na(browse9.6sc_test$moose_density))
browse9.6sc_test[1497, ]
browse9.6sc_test[5522, ]
browse9.6sc_test$moose_density <- ifelse(is.na(browse9.6sc_test$moose_density), 0, browse9.6sc_test$moose_density)
sum(is.na(browse9.6sc_test$moose_density))

load("processdata_copy/browse9.6scpos.rda")
browse9.6sc_test_pos <- left_join(browse9.6scpos, moose_mean_density, by = "KOMNR")
str(browse9.6sc_test_pos$moose_density)
sum(is.na(browse9.6sc_test_pos$moose_density))
browse9.6sc_test_pos$moose_density <- ifelse(is.na(browse9.6sc_test_pos$moose_density), 0, browse9.6sc_test_pos$moose_density)


library(lme4)
library(glmmTMB)


## BIN
load("output_copy/m2bin_roads.rda")
rr_bin <- glmer(factor(proplt > 0) ~ log(distvei2+1) + skogkategori + treartgruppe9 + browspres_merged + helling + HOH + I(HOH^2) +  ac + moose_density + (1|KOMNR),
family = binomial(),
data = browse9.6sc_test)

rr_bin_int <- glmer(factor(proplt > 0) ~ log(distvei2+1) + skogkategori + treartgruppe9 + browspres_merged + helling + HOH + I(HOH^2) +  ac + moose_density + moose_density*log(distvei2+1) + (1|KOMNR),
family = binomial(),
data = browse9.6sc_test)


library(AICcmodavg)
candmods_BP_hbeta <- list(rr_bin, m2bin_roads, rr_bin_int)
aictab(candmods_BP_hbeta, modnames = NULL,
                       second.ord = TRUE, nobs = NULL, sort = TRUE)
#       K     AICc Delta_AICc AICcWt Cum.Wt       LL
# Mod1 14 10898.69       0.00   0.62   0.62 -5435.32
# Mod3 15 10900.05       1.36   0.31   0.93 -5435.00
# Mod2 13 10902.98       4.29   0.07   1.00 -5438.47

summary(rr_bin) # moose density negativ *


## BETA
load("output_copy/m3betaroad.rda")
rr_beta <- glmmTMB(proplt ~ skogkategori + treartgruppe9 + ac + helling + HOH + I(HOH^2) + browspres_merged + moose_density + (1|KOMNR),
            data = browse9.6sc_test_pos,
            family = beta_family())

rr_beta_int <- glmmTMB(proplt ~ skogkategori + treartgruppe9 + ac + helling + HOH + I(HOH^2) + browspres_merged + moose_density + moose_density*log(distvei2+1) + (1|KOMNR),
            data = browse9.6sc_test_pos,
            family = beta_family())


library(bbmle)
AIC(rr_beta, m3betaroad, rr_beta_int)
ICtab(rr_beta, m3betaroad, rr_beta_int, type = "AIC", weights = TRUE, delta = TRUE)

summary(rr_beta) # moose density not sign.


```






## Look at changes in proportion of trees from 9th to 10th takst (plant performance)

```{r}
load("rawdata/browse0.1.rda")

library(dplyr)
names(browse0.1)

```


```{r}
recruits_full <- browse0.1[, c(1,3,5,7:9,27:29,31:45,62:64,74,76:83,88,90,103,105,112:117)]
str(recruits_full)
names(recruits_full)

# recruits <- recruits_full[, -c(7:9,22:24, 26:33)]
# str(recruits)
# names(recruits)

# recruits_test$FLATEID <- as.factor(recruits_test$FLATEID)
# str(levels(recruits_test$FLATEID))
# unique(recruits_test$FLATEID)

#### TRY THIS BEFORE SPLITTING
recruits_full$Lauv1 <- ifelse(recruits_full$takst == 10, recruits_full$Lauv_0_PRHA + recruits_full$Bjork_0_PRHA + recruits_full$ROS_0_PRHA, NA)
recruits_full$Lauv2 <- ifelse(recruits_full$takst == 10, recruits_full$Lauv_0_25_PRHA + recruits_full$Bjork_0_25_PRHA + recruits_full$ROS_0_25_PRHA, NA)
recruits_full$Lauv3 <- ifelse(recruits_full$takst == 10, recruits_full$Lauv_25_49_PRHA + recruits_full$Bjork_25_49_PRHA + recruits_full$ROS_25_49_PRHA, NA)

recruits <- subset(recruits_full, treartgruppe10!="BJORK")



recruits_910 <- split(recruits, recruits$takst)

recruits_9 <- recruits_910[['9']]
summary(recruits9)

recruits_10 <- recruits_910[['10']]
summary(recruits10)

## The join/ merge does not work with the data where I have duplicated rows
recruits_join <- inner_join(recruits_10, recruits_9, by = "FLATEID")
recruits_join2 <- merge(recruits_10, recruits_9, by = "FLATEID")



## inner_join works, when I do not have the dublicated rows
recruits9 <- distinct(recruits_9, FLATEID, .keep_all = TRUE)
recruits10 <- distinct(recruits_10, FLATEID, .keep_all = TRUE)
recruits_test <- inner_join(recruits9, recruits10, by = "FLATEID")

```



#### With trees below 5 cm DBH (same as in paper)
```{r}
### Number of trees 2(10)/ number of trees 1(9)



# sum(recruits10$Furu_0_25_PRHA,na.rm=TRUE)/sum(recruits9$Furu_0_PRHA,na.rm=TRUE)
# # = 0.2254849
# sum(recruits9$Furu_0_25_PRHA,na.rm=TRUE)/sum(recruits9$Furu_0_PRHA,na.rm=TRUE)
# # = 0.1496975
# sum((recruits10$Lauv_0_25_PRHA + recruits10$Bjork_0_25_PRHA),na.rm=TRUE)/sum(recruits9$Lauv_0_PRHA,na.rm=TRUE) # pool lauv and bjork for 10th takst, because they are pooled in 9th takst?
# # = 0.427326
# sum((recruits9$Lauv_0_25_PRHA),na.rm=TRUE)/sum(recruits9$Lauv_0_PRHA,na.rm=TRUE) # pool lauv and bjork for 10th takst, because they are pooled in 9th takst?
# # = 0.3694553


# recruits$proplt2 <- ifelse(recruits$treartgruppe10 == "FURU" | recruits$treartgruppe9 == "FURU", 
#                                 recruits$Furu_0_25_PRHA/recruits$Furu_0_PRHA, 
#                                 recruits$Lauv_0_25_PRHA/recruits$Lauv_0_PRHA)
# str(recruits$proplt2)




# 9th and 10th
recruits_test$proplt3 <- (recruits_test$Furu_0_25_PRHA.y + recruits_test$Lauv2.y)/(recruits_test$Furu_0_PRHA.x + recruits_test$Lauv_0_PRHA.x)
str(recruits_test$proplt2)

# 9th
recruits_test$proplt1 <- (recruits_test$Furu_0_25_PRHA.x + recruits_test$Lauv_0_25_PRHA.x)/(recruits_test$Furu_0_PRHA.x + recruits_test$Lauv_0_PRHA.x)
str(recruits_test$proplt1)

recruits_test$proplt2 <- (recruits_test$Furu_25_49_PRHA.x + recruits_test$Lauv_25_49_PRHA.x)/(recruits_test$Furu_0_25_PRHA.x + recruits_test$Lauv_0_25_PRHA.x)
str(recruits_test$proplt2)



### Number of trees 3(10)/ number of trees 1(9)

sum(recruits10$Furu_25_49_PRHA,na.rm=TRUE)/sum(recruits9$Furu_0_PRHA,na.rm=TRUE)
# = 0.1192973
sum(recruits9$Furu_25_49_PRHA,na.rm=TRUE)/sum(recruits9$Furu_0_PRHA,na.rm=TRUE)
# = 0.09093612
sum((recruits10$Lauv_25_49_PRHA + recruits10$Lauv_25_49_PRHA),na.rm=TRUE)/sum(recruits9$Lauv_0_PRHA,na.rm=TRUE) # pool lauv and bjork for 10th takst, because they are pooled in 9th takst?
# = 0.05117802
sum((recruits$Lauv_25_49_PRHA),na.rm=TRUE)/sum(recruits9$Lauv_0_PRHA,na.rm=TRUE) # pool lauv and bjork for 10th takst, because they are pooled in 9th takst?
# = 0.1373873


# recruits$proplt3 <- ifelse(recruits$treartgruppe10 == "FURU" | recruits$treartgruppe9 == "FURU", 
#                                 recruits$Furu_25_49_PRHA/recruits$Furu_0_PRHA, 
#                                 recruits$Lauv_25_49_PRHA/recruits$Lauv_0_PRHA)
# str(recruits$proplt3)




# 9th and 10th
recruits_test$proplt4 <- (recruits_test$Furu_25_49_PRHA.y + recruits_test$Lauv3.y)/(recruits_test$Furu_0_PRHA.x + recruits_test$Lauv_0_25_PRHA.x)
str(recruits_test$proplt3)

names(recruits_test)
recruits_cor <- recruits_test[, c(98,100)]
recruits_cor1 <- recruits_test[, c(99,101)]


recruits_cor <- recruits_cor[Reduce(`&`, lapply(recruits_cor, is.finite)),]
recruits_cor1 <- recruits_cor1[Reduce(`&`, lapply(recruits_cor1, is.finite)),]


cor(recruits_cor)
#           proplt2    proplt   proplt3
# proplt2 1.0000000 0.5951219 0.3916736
# proplt  0.5951219 1.0000000 0.5284639
# proplt3 0.3916736 0.5284639 1.0000000

cor(recruits_cor1)



```






