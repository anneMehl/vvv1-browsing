---
title: "01_cleaning_data_browse_vers2"
author: "anne"
date: "20 desember 2019"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



## For browse9.5 (tree height classes, not tree density)

```{r}
load("processdata/browse9.5.rda")
load("rawdata/browse0.1.rda")
```

##### Subsetting on 9th and 10th cycle
```{r}
browse0.1_910 <- split(browse0.1, browse0.1$takst)

browse9.1 <- browse0.1_910[['9']]
summary(browse9.1)

# save(browse9.1, file = "browse9.1.rda")
load("processdata/browse9.1.rda")
load("processdata/browse9.5.rda")

browse9.1 <- browse9.1[,c(1:5,7:9,15:24,34:36,40:45,51,59,62:67,74,76:79,88:90,99:105,112:115)]

# browse9.2$x <- NULL


browse9.5 <- browse9.1
browse9.5 <- browse9.5[,c(1:3,5:8,19:24,36,41:43,48,50:54)]
browse9.5 <- subset(browse9.5, select = -c(27:32,34:36))


save(browse9.5, file = "browse9.5.rda")

```

##### Explore NAs 
```{r}

nrow(browse9.5)
nrow(na.omit(browse9.5))

sum(is.na(browse9.5$beitetrykk9))
sum(is.na(browse9.5$tretetthet9))

summary(browse9.5)

browse9.5$distvei2[is.na(browse9.5$distvei2)] <- 2218
browse9.5$disthus[is.na(browse9.5$disthus)] <- 3000

browse9.5 <- na.omit(browse9.5)


# save(browse9.5, file = "browse9.5.rda")
load("processdata/browse9.5.rda")
load("processdata/browse9.5msc.rda")


# browse9.5$FLATEID <- as.factor(browse9.5$FLATEID)
# str(levels(browse9.5$FLATEID)) 
# unique(browse9.5$FLATEID)
# 
browse9.5m$FLATEID <- as.factor(browse9.5m$FLATEID)
str(levels(browse9.5m$FLATEID))
unique(browse9.5m$FLATEID)

```


```{r}
library(ggplot2)

ggplot(data = browse9.5, aes(skogkategori)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9.5, aes(kant)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9.5m, aes(treartgruppe9)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9.5, aes(region)) +
  geom_bar()+
  theme_classic()


```


```{r}

browse9.5$skogkategori <- factor(browse9.5$skogkategori, levels = c("Lavproduktiv_eldreskog", "Høyproduktiv_eldreskog", "Høyproduktiv_ungskog",  "Lavproduktiv_ungskog", "Uproduktiv_skog"))
browse9.5$kant <- factor(browse9.5$kant, levels = c("kant >20m", "kant <10m", "kant 10-20m", "mangler kant")) 
browse9.5$treartgruppe9 <- factor(browse9.5$treartgruppe9, levels = c("LAUV", "FURU"))

browse9.5$region <- factor(browse9.5$region, levels = c("Hedmark", "Agder", "Buskerud", "Hordaland",  "More og Romsdal", "Nord-Trondelag", "Nordland", "Oppland", "Ostfold-Akershus", "Rogaland", "Sogn og Fjordane", "Sor-Trondelag", "Troms", "Vestfold-Telemark"))



```

```{r}

browse9.5$beitetrykkr <- as.integer(round(browse9.5$beitetrykk9))
browse9.5$bt100 <- browse9.5$beitetrykkr/100
```

```{r}
save(browse9.5, file = "browse9.5.rda")

save(browse9.6, file = "browse9.6.rda")
```


##### Subsets and new variable(s)
```{r}

## Creating new variable "browsed merged"
load("processdata/browse9.5.rda")
browse9.5 <- as.data.frame(browse9.5)

tmp1 <- browse9.5[browse9.5$treartgruppe9 == "FURU", ]
tmp2 <- browse9.5[browse9.5$treartgruppe9 == "LAUV", ]
tmp3 <- browse9.5[browse9.5$treartgruppe9 == "ROS", ]
browse9.5m <-  browse9.5[browse9.5$treartgruppe9 != "FURU", ]
browse9.5m <-  browse9.5m[!duplicated(browse9.5m$FLATEID), ]
browse9.5m$treartgruppe9 <-  "LAUV"
browse9.5m <- rbind(browse9.5m, tmp1)
browse9.5m$rosTD <- tmp3$tretetthet9[match(browse9.5m$FLATEID, tmp3$FLATEID)]
browse9.5m$rosBP <- tmp3$beitetrykkr [match(browse9.5m$FLATEID, tmp3$FLATEID)]
browse9.5m$lauvTD <- tmp2$tretetthet9[match(browse9.5m$FLATEID, tmp2$FLATEID)]
browse9.5m$lauvBP <- tmp2$beitetrykkr [match(browse9.5m$FLATEID, tmp2$FLATEID)]

browse9.5m$rosTD <- ifelse(is.na(browse9.5m$rosTD), 0, browse9.5m$rosTD)
browse9.5m$rosBP <- ifelse(is.na(browse9.5m$rosBP), 0, browse9.5m$rosBP)
browse9.5m$lauvTD <- ifelse(is.na(browse9.5m$lauvTD), 0, browse9.5m$lauvTD)
browse9.5m$lauvBP <- ifelse(is.na(browse9.5m$lauvBP), 0, browse9.5m$lauvBP)
  
browse9.5m$browspres_merged <- browse9.5m$beitetrykkr
browse9.5m$browspres_merged[browse9.5m$treartgruppe9 == "LAUV"] <- (browse9.5m$lauvTD[browse9.5m$treartgruppe9 == "LAUV"] * browse9.5m$lauvBP[browse9.5m$treartgruppe9 == "LAUV"] + browse9.5m$rosTD[browse9.5m$treartgruppe9 == "LAUV"] * browse9.5m$rosBP[browse9.5m$treartgruppe9 == "LAUV"])/ (browse9.5m$lauvTD[browse9.5m$treartgruppe9 == "LAUV"] + browse9.5m$rosTD[browse9.5m$treartgruppe9 == "LAUV"])

browse9.5m$distvei2[is.na(browse9.5m$distvei2)] <- 2218
browse9.5m$disthus[is.na(browse9.5m$disthus)] <- 3000



nrow(browse9.5m)
nrow(na.omit(browse9.5m))

summary(browse9.5m)

sum(is.na(browse9.5m$beitetrykkr))


browse9.5m <- as.data.frame(browse9.5m)

browse9.5m <- browse9.5m[,c(1:24,29)]

## Creating new variable proportion large trees "proplt"
browse9.5m$proplt <- ifelse(browse9.5m$treartgruppe9 == "FURU", 
                            (browse9.5m$Furu_0_25_PRHA + browse9.5m$Furu_25_49_PRHA)/(browse9.5m$Furu_0_PRHA + browse9.5m$Furu_0_25_PRHA + browse9.5m$Furu_25_49_PRHA), 
                            (browse9.5m$Lauv_0_25_PRHA + browse9.5m$Lauv_25_49_PRHA)/ (browse9.5m$Lauv_0_PRHA + browse9.5m$Lauv_0_25_PRHA + browse9.5m$Lauv_25_49_PRHA))


nrow(browse9.5m)
nrow(na.omit(browse9.5m))

browse9.5m <- na.omit(browse9.5m)


browse9.5msc <- browse9.5msc[,c(1,3,7,15:17,19:20,25:26,33,40)]
save(browse9.5msc, file = "browse9.5msc.rda")


# Subset on different cuts for disthus
browse9.6 <- browse9.5m[ which(browse9.5m$disthus > 400), ]
save(browse9.6, file = "browse9.6.rda")

# browse9.7pos <- browse9.6pos[ which(browse9.6pos$disthus > 200), ]
# save(browse9.7pos, file = "browse9.7pos.rda")



save(browse9.5, file = "browse9.5.rda")

save(browse9.5m, file = "browse9.5m.rda")



```

## Test for difference between regions
```{r}
##### House
load("processdata/browse9.5msc.rda")
browse9.5m_region <- browse9.5m
browse9.5m_region <- browse9.5m_region[,c(1:3,7,14:20,25:26,33,40)]

pvars <- c("disthus_400", "HOH")
browse9.5m_regionsc <- browse9.5m_region
browse9.5m_regionsc[pvars] <- lapply(browse9.5m_regionsc[pvars],scale)

save(browse9.5m_regionsc, file = "browse9.5m_regionsc.rda")

## Subset municipalities ----
hedmark <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Hedmark", ]
agder <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Agder", ]
buskerud <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Buskerud", ]
hordaland <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Hordaland", ]
more_og_romsdal <- browse9.5m_regionsc[browse9.5m_regionsc$region == "More og Romsdal", ]
nord_trondelag <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Nord-Trondelag", ]
nordland <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Nordland", ]
oppland <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Oppland", ]
ostfold_akershus <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Ostfold-Akershus", ]
rogaland <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Rogaland", ]
sogn_og_fjordane <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Sogn og Fjordane", ]
sor_trondelag <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Sor-Trondelag", ]
troms <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Troms", ]
vestfold_telemark <- browse9.5m_regionsc[browse9.5m_regionsc$region == "Vestfold-Telemark", ]



##### Road
load("processdata/browse9.6.rda")
browse9.6_region <- browse9.6
browse9.6_region <- browse9.6_region[,c(1:3,7,14:20,25:26,33,40)]

pvars <- c("HOH","ac" ) #  "helling", "browspres_merged", "ac" 
browse9.6_regionsc <- browse9.6_region
browse9.6_regionsc[pvars] <- lapply(browse9.6_regionsc[pvars],scale)

save(browse9.6_regionsc, file = "browse9.6_regionsc.rda")
```


## browse9.5m

##### threshold cuts disthus
```{r}
browse9.5m$disthus_1000 <- ifelse(browse9.5m$disthus >= 1000, 1000, browse9.5m$disthus)
# browse9.5m$disthus_cut950 <- ifelse(browse9.5m$disthus >= 950, 950, browse9.5m$disthus)
browse9.5m$disthus_900 <- ifelse(browse9.5m$disthus >= 900, 900, browse9.5m$disthus)
# browse9.5m$disthus_cut850 <- ifelse(browse9.5m$disthus >= 850, 850, browse9.5m$disthus)
browse9.5m$disthus_800 <- ifelse(browse9.5m$disthus >= 800, 800, browse9.5m$disthus)
# browse9.5m$disthus_cut750 <- ifelse(browse9.5m$disthus >= 750, 750, browse9.5m$disthus)
browse9.5m$disthus_700 <- ifelse(browse9.5m$disthus >= 700, 700, browse9.5m$disthus)
# browse9.5m$disthus_cut650 <- ifelse(browse9.5m$disthus >= 650, 650, browse9.5m$disthus)
browse9.5m$disthus_600 <- ifelse(browse9.5m$disthus >= 600, 600, browse9.5m$disthus)
browse9.5m$disthus_500 <- ifelse(browse9.5m$disthus >= 500, 500, browse9.5m$disthus)
browse9.5m$disthus_400 <- ifelse(browse9.5m$disthus >= 400, 400, browse9.5m$disthus)
browse9.5m$disthus_350 <- ifelse(browse9.5m$disthus >= 350, 350, browse9.5m$disthus)
browse9.5m$disthus_300 <- ifelse(browse9.5m$disthus >= 300, 300, browse9.5m$disthus)
browse9.5m$disthus_200 <- ifelse(browse9.5m$disthus >= 200, 200, browse9.5m$disthus)
# browse9.5m$disthus_150 <- ifelse(browse9.5m$disthus >= 150, 150, browse9.5m$disthus)
browse9.5m$disthus_175 <- ifelse(browse9.5m$disthus >= 175, 175, browse9.5m$disthus)
browse9.5m$disthus_160 <- ifelse(browse9.5m$disthus >= 160, 160, browse9.5m$disthus)
# browse9.5m$disthus_190 <- ifelse(browse9.5m$disthus >= 190, 190, browse9.5m$disthus)
# browse9.2$disthus_trunc_cut1000 <- ifelse(browse9.2$disthus_trunc >= 1000, 1000, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut900 <- ifelse(browse9.2$disthus_trunc >= 900, 900, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut800 <- ifelse(browse9.2$disthus_trunc >= 800, 800, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut700 <- ifelse(browse9.2$disthus_trunc >= 700, 700, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut600 <- ifelse(browse9.2$disthus_trunc >= 600, 600, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut500 <- ifelse(browse9.2$disthus_trunc >= 500, 500, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut400 <- ifelse(browse9.2$disthus_trunc >= 400, 400, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut300 <- ifelse(browse9.2$disthus_trunc >= 300, 300, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut200 <- ifelse(browse9.2$disthus_trunc >= 200, 200, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut150 <- ifelse(browse9.2$disthus_trunc >= 150, 150, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut175 <- ifelse(browse9.2$disthus_trunc >= 175, 175, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut160 <- ifelse(browse9.2$disthus_trunc >= 160, 160, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut190 <- ifelse(browse9.2$disthus_trunc >= 190, 190, browse9.2$disthus_trunc)
# browse9.2$disthus_trunc_cut100 <- ifelse(browse9.2$disthus_trunc >= 100, 100, browse9.2$disthus_trunc)

save(browse9.5m, file = "browse9.5m.rda")
```





## Add moose density (mean over 5 year period to datasets and models)
```{r}
library(readr)
moose_mean_density <- read_csv("processdata_copy/five_y_mean_density.csv", na = "NA")
str(moose_mean_density)
library(tidyverse)
moose_mean_density <- moose_mean_density %>%
  rename(KOMNR = knr2017) %>%
  rename(moose_density = five_y_mean_density)
str(moose_mean_density)

```

#### Recruits house
```{r}
## HOUSE
load("processdata_copy/browse9.5msc.rda")
browse9.5msc_test <- left_join(browse9.5msc, moose_mean_density, by = "KOMNR")
str(browse9.5msc_test$moose_density)
sum(is.na(browse9.5msc_test$moose_density))
which(is.na(browse9.5msc_test$moose_density))
browse9.5msc_test[2254, ]
browse9.5msc_test[2257, ]
browse9.5msc_test$moose_density <- ifelse(is.na(browse9.5msc_test$moose_density), 0, browse9.5msc_test$moose_density)
sum(is.na(browse9.5msc_test$moose_density))

# browse9.5msc_test_pos <- browse9.5msc_test[browse9.5msc_test$bt100 > 0, ]
# sum(is.na(browse9.5msc_test_pos))

load("processdata_copy/browse9.5mpossc.rda")
browse9.5msc_test_pos <- left_join(browse9.5mpossc, moose_mean_density, by = "KOMNR")
str(browse9.5msc_test_pos$moose_density)
sum(is.na(browse9.5msc_test_pos$moose_density))
browse9.5msc_test_pos$moose_density <- ifelse(is.na(browse9.5msc_test_pos$moose_density), 0, browse9.5msc_test_pos$moose_density)
sum(is.na(browse9.5msc_test_pos$moose_density))

```


#### Recruits roads
```{r}
## ROADS
load("processdata_copy/browse9.6sc.rda")
browse9.6sc_test <- left_join(browse9.6sc, moose_mean_density, by = "KOMNR")
str(browse9.6sc_test$moose_density)
sum(is.na(browse9.6sc_test$moose_density))
which(is.na(browse9.6sc_test$moose_density))
browse9.6sc_test[1497, ]
browse9.6sc_test[5522, ]
browse9.6sc_test$moose_density <- ifelse(is.na(browse9.6sc_test$moose_density), 0, browse9.6sc_test$moose_density)
sum(is.na(browse9.6sc_test$moose_density))

load("processdata_copy/browse9.6scpos.rda")
browse9.6sc_test_pos <- left_join(browse9.6scpos, moose_mean_density, by = "KOMNR")
str(browse9.6sc_test_pos$moose_density)
sum(is.na(browse9.6sc_test_pos$moose_density))
browse9.6sc_test_pos$moose_density <- ifelse(is.na(browse9.6sc_test_pos$moose_density), 0, browse9.6sc_test_pos$moose_density)



```






## Look at changes in proportion of trees from 9th to 10th takst (plant performance)

```{r}
load("rawdata/browse0.1.rda")

library(dplyr)
names(browse0.1)

```

#### Prepare data set for plant performance test
```{r}
recruits_full <- browse0.1[, c(1,3,5,7:9,27:29,31:45,62:67,74,76:83,88,90,103,105,112:117)]
str(recruits_full)
names(recruits_full)

# recruits <- recruits_full[, -c(7:9,22:24, 26:33)]
# str(recruits)
# names(recruits)

# recruits_test$FLATEID <- as.factor(recruits_test$FLATEID)
# str(levels(recruits_test$FLATEID))
# unique(recruits_test$FLATEID)

#### TRY THIS BEFORE SPLITTING
recruits_full$Lauv1 <- ifelse(recruits_full$takst == 10, recruits_full$Lauv_0_PRHA + recruits_full$Bjork_0_PRHA, NA)
recruits_full$Lauv2 <- ifelse(recruits_full$takst == 10, recruits_full$Lauv_0_25_PRHA + recruits_full$Bjork_0_25_PRHA, NA)
recruits_full$Lauv3 <- ifelse(recruits_full$takst == 10, recruits_full$Lauv_25_49_PRHA + recruits_full$Bjork_25_49_PRHA, NA)

recruits <- subset(recruits_full, treartgruppe10!="BJORK")


recruits_910 <- split(recruits, recruits$takst)

recruits_9 <- recruits_910[['9']]
# summary(recruits_9)
names(recruits_9)

recruits_9 <- recruits_9[ ,-c(7:12,16:18,22:24,32:39,48:52)]
names(recruits_9)



recruits_10 <- recruits_910[['10']]
# summary(recruits_10)
names(recruits_10)

recruits_10 <- recruits_10[ ,-c(2,4:11, 13:14,16:51)]
names(recruits_10)



# ## The join/ merge does not work with the data where I have duplicated rows
# recruits_join <- inner_join(recruits_9, recruits_10, by = c("FLATEID","treartgruppe9")) # add treartgruppe as well to join by
# recruits_join2 <- merge(recruits_10, recruits_9, by = c("FLATEID"))



## inner_join works, when I do not have the dublicated rows
recruits9 <- distinct(recruits_9, FLATEID, .keep_all = TRUE)
recruits10 <- distinct(recruits_10, FLATEID, .keep_all = TRUE)
recruits <- inner_join(recruits9, recruits10, by = "FLATEID", suffix =
c("_9", "_10"))


names(recruits)


```

####Look at changes in proportion of trees from 9th to 10th takst --> With trees below 5 cm DBH (same as in paper)
```{r}
### Number of trees 2(10)/ number of trees 1(9)

# 9th and 10th
recruits_test$proplt3 <- (recruits_test$Furu_0_25_PRHA.y + recruits_test$Lauv2.y)/(recruits_test$Furu_0_PRHA.x + recruits_test$Lauv_0_PRHA.x)
str(recruits_test$proplt2)

# 9th
recruits_test$proplt1 <- (recruits_test$Furu_0_25_PRHA.x + recruits_test$Lauv_0_25_PRHA.x)/(recruits_test$Furu_0_PRHA.x + recruits_test$Lauv_0_PRHA.x)
str(recruits_test$proplt1)

recruits_test$proplt2 <- (recruits_test$Furu_25_49_PRHA.x + recruits_test$Lauv_25_49_PRHA.x)/(recruits_test$Furu_0_25_PRHA.x + recruits_test$Lauv_0_25_PRHA.x)
str(recruits_test$proplt2)



### Number of trees 3(10)/ number of trees 1(9)

# 9th and 10th
recruits_test$proplt4 <- (recruits_test$Furu_25_49_PRHA.y + recruits_test$Lauv3.y)/(recruits_test$Furu_0_PRHA.x + recruits_test$Lauv_0_25_PRHA.x)
str(recruits_test$proplt3)

names(recruits_test)
recruits_cor <- recruits_test[, c(98,100)]
recruits_cor1 <- recruits_test[, c(99,101)]


recruits_cor <- recruits_cor[Reduce(`&`, lapply(recruits_cor, is.finite)),]
recruits_cor1 <- recruits_cor1[Reduce(`&`, lapply(recruits_cor1, is.finite)),]


cor(recruits_cor)
#           proplt2    proplt   proplt3
# proplt2 1.0000000 0.5951219 0.3916736
# proplt  0.5951219 1.0000000 0.5284639
# proplt3 0.3916736 0.5284639 1.0000000

cor(recruits_cor1)



```







## Make a new recruits dataset

#### Duplicate rows and make column treartgruppe9
```{r}
# recruits_test is made in: #### Prepare data set for plant performance test

str(recruits)
table(as.factor(recruits$treartgruppe9))

recruits <- recruits %>% slice(rep(1:n(), each = 3))
head(recruits)

x <- factor(c("ROS","FURU","LAUV"))
recruits$treartgruppe9 <- rep(x, 14479)
head(recruits$treartgruppe9)
head(recruits)

```


#### Make column tretetthet9
```{r}
recruits$tretetthet9 <- ifelse(recruits$treartgruppe9 == "ROS", recruits$elgROSha9, NA)
recruits$tretetthet9 <- ifelse(recruits$treartgruppe9 == "FURU", recruits$elgFURUha9, recruits$tretetthet9)
recruits$tretetthet9 <- ifelse(recruits$treartgruppe9 == "LAUV", recruits$elgLAUVha9, recruits$tretetthet9)

head(recruits$tretetthet9, n = 12)
sum(is.na(recruits$tretetthet9)) #44, meaning that there were no trees to count? But then it should have been 0, no?


```


#### Make column beitetrykk9
```{r}
recruits$beitetrykk9 <- ifelse(recruits$treartgruppe9 == "ROS", recruits$elgbROSprs9, NA)
recruits$beitetrykk9 <- ifelse(recruits$treartgruppe9 == "FURU", recruits$elgbFURUprs9, recruits$beitetrykk9)
recruits$beitetrykk9 <- ifelse(recruits$treartgruppe9 == "LAUV", recruits$elgbLAUVprs9, recruits$beitetrykk9)

head(recruits$beitetrykk9, n = 12)
sum(is.na(recruits$beitetrykk9)) #21073, meaning that there could not have been browsing pressure, because there were no trees to browse on 


## NA the ones where tretetthet is 0, but we have beitetrykk values
recruits$beitetrykk9 <- ifelse(recruits$tretetthet9 != 0, recruits$beitetrykk9, NA)
sum(is.na(recruits$beitetrykk9)) #21182, meaning that there could not have been browsing pressure, because there were no trees to browse on  


```


#### Make column proplt (which will be height class 3 from the 10th cycle) 
```{r}
recruits$recruitment <- ifelse(recruits$treartgruppe9 == "ROS", recruits$ROS_25_49_PRHA, NA)
recruits$recruitment <- ifelse(recruits$treartgruppe9 == "FURU", recruits$Furu_25_49_PRHA_10, recruits$recruitment)
recruits$recruitment <- ifelse(recruits$treartgruppe9 == "LAUV", recruits$Lauv3, recruits$recruitment)

head(recruits$recruitment)
sum(is.na(recruits$recruitment)) #921, because there were no trees to count in that height class? Or where there no trees of the species? If there were trees of the species but not in height class, should in not be 0?

```


#### Make variable browse_merged
```{r}
tmp1 <- recruits[recruits$treartgruppe9 == "FURU", ]
tmp2 <- recruits[recruits$treartgruppe9 == "LAUV", ]
tmp3 <- recruits[recruits$treartgruppe9 == "ROS", ]
recruits_tmp <-  recruits[recruits$treartgruppe9 != "FURU", ]
recruits_tmp <-  recruits_tmp[!duplicated(recruits_tmp$FLATEID), ]
recruits_tmp$treartgruppe9 <-  "LAUV"
recruits_tmp <- rbind(recruits_tmp, tmp1)
recruits_tmp$rosTD <- tmp3$tretetthet9[match(recruits_tmp$FLATEID, tmp3$FLATEID)]
recruits_tmp$rosBP <- tmp3$beitetrykk9 [match(recruits_tmp$FLATEID, tmp3$FLATEID)]
recruits_tmp$lauvTD <- tmp2$tretetthet9[match(recruits_tmp$FLATEID, tmp2$FLATEID)]
recruits_tmp$lauvBP <- tmp2$beitetrykk9 [match(recruits_tmp$FLATEID, tmp2$FLATEID)]

recruits_tmp$rosTD <- ifelse(is.na(recruits_tmp$rosTD), 0, recruits_tmp$rosTD)
recruits_tmp$rosBP <- ifelse(is.na(recruits_tmp$rosBP), 0, recruits_tmp$rosBP)
recruits_tmp$lauvTD <- ifelse(is.na(recruits_tmp$lauvTD), 0, recruits_tmp$lauvTD)
recruits_tmp$lauvBP <- ifelse(is.na(recruits_tmp$lauvBP), 0, recruits_tmp$lauvBP)
  
recruits_tmp$browspres_merged <- recruits_tmp$beitetrykk9
## !! change this so we have FURU, LAUV and ROS !! ##
recruits_tmp$browspres_merged[recruits_tmp$treartgruppe9 == "LAUV"] <- (recruits_tmp$lauvTD[recruits_tmp$treartgruppe9 == "LAUV"] * recruits_tmp$lauvBP[recruits_tmp$treartgruppe9 == "LAUV"] + recruits_tmp$rosTD[recruits_tmp$treartgruppe9 == "LAUV"] * recruits_tmp$rosBP[recruits_tmp$treartgruppe9 == "LAUV"])/ (recruits_tmp$lauvTD[recruits_tmp$treartgruppe9 == "LAUV"] + recruits_tmp$rosTD[recruits_tmp$treartgruppe9 == "LAUV"])
```



#### Stuff like... NAs, level orders, etc.
```{r}

nrow(recruits_test_rep_merge)
nrow(na.omit(recruits_test_rep_merge))

sum(is.na(recruits_test_rep_merge$distvei2))
sum(is.na(recruits_test_rep_merge$disthus))
# ... maybe look at others

recruits_test_rep$distvei2[is.na(recruits_test_rep$distvei2)] <- 2218 # max distance to roads
recruits_test_rep$disthus[is.na(recruits_test_rep$disthus)] <- 3000# max distance to house


recruits_test_rep$skogkategori <- factor(recruits_test_rep$skogkategori, levels = c("Lavproduktiv_eldreskog", "Høyproduktiv_eldreskog", "Høyproduktiv_ungskog",  "Lavproduktiv_ungskog", "Uproduktiv_skog"))
recruits_test_rep$kant <- factor(recruits_test_rep$kant, levels = c("kant >20m", "kant <10m", "kant 10-20m", "mangler kant")) 
recruits_test_rep$treartgruppe9 <- factor(recruits_test_rep$treartgruppe9, levels = c("LAUV", "FURU"))

# recruits_test_rep$region <- factor(recruits_test_rep$region, levels = c("Hedmark", "Agder", "Buskerud", "Hordaland",  "More og Romsdal", "Nord-Trondelag", "Nordland", "Oppland", "Ostfold-Akershus", "Rogaland", "Sogn og Fjordane", "Sor-Trondelag", "Troms", "Vestfold-Telemark"))


nrow(recruits_test_rep_merge)
nrow(na.omit(recruits_test_rep_merge))



# Subset for roads data set
recruits_roads <- recruits_test_rep_merge[ which(recruits_test_rep_merge$disthus > 400), ]

```





#### Save data set
```{r}
save(recruits_test_rep, file = "recruits_test_rep.rda")
load("processdata/recruits_test_rep.rda")

```







