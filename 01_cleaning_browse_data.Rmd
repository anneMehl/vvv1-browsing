---
title: "01_cleaning_browse_data"
author: "anne"
date: "31 oktober 2018"
output: word_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
load("processdata/browse.rda")
load("processdata/browse_sub.rda")
```

## Cleaning data
```{r}
class(browse)
str(browse)
head(browse, n = 3)
names(browse)

str(browse_sub)
head(browse_sub, n = 3)
names(browse-sub)

```

Create a subset of browse with less variables
```{r}
browse_sub  <- browse[,c(1:5,7:9,15:24,27:45,51,59,61:67,69,74,76:83,85,87:90,92:97,99:105,108:122)]
head(browse_sub, n = 3)

save(browse_sub, file = "browse_sub.rda")


load("processdata/browse_sub.rda")
head(browse_sub)
names(browse_sub)
```



##### change column names, structure (numeric, integer, factor), and level names for factors
```{r}
# new column


# col. names

# colnames(fdata1)[colnames(fdata1)=="ï..ID"] <- "ID"


# structure 
browse_sub$FYLNR <- as.integer(browse_sub$FYLNR)
browse_sub$KOMNR <- as.integer(browse_sub$KOMNR)
browse_sub$elgbROSprs10 <- as.numeric(browse_sub$elgbROSprs10)
browse_sub$elgbFURUprs10 <- as.numeric(browse_sub$elgbFURUprs10)
browse_sub$elgbBJORKprs10 <- as.numeric(browse_sub$elgbBJORKprs10)
browse_sub$ROS_0_PRHA <- as.integer(browse_sub$ROS_0_PRHA)
browse_sub$ROS_0_25_PRHA <- as.integer(browse_sub$ROS_0_25_PRHA)
browse_sub$ROS_25_49_PRHA <- as.integer(browse_sub$ROS_25_49_PRHA)
browse_sub$Bjork_0_PRHA <- as.integer(browse_sub$Bjork_0_PRHA)
browse_sub$Bjork_0_25_PRHA <- as.integer(browse_sub$Bjork_0_25_PRHA)
browse_sub$Bjork_25_49_PRHA <- as.integer(browse_sub$Bjork_25_49_PRHA)
browse_sub$elgFURUha10 <- as.numeric(browse_sub$elgFURUha10)
browse_sub$elgROSha10 <- as.numeric(browse_sub$elgROSha10)
browse_sub$elgBJORKha10 <- as.numeric(browse_sub$elgBJORKha10)
browse_sub$elgLAUVha10 <- as.numeric(browse_sub$elgLAUVha10)
browse_sub$treartgruppe <- as.factor(browse_sub$treartgruppe)
browse_sub$skogkategori <- as.factor(browse_sub$skogkategori)
browse_sub$kant <- as.factor(browse_sub$kant)
browse_sub$region <- as.factor(browse_sub$region)
browse_sub$landsdel <- as.factor(browse_sub$landsdel)
browse_sub$tretetthet0 <- as.numeric(browse_sub$tretetthet0)
browse_sub$tretetthet025 <- as.numeric(browse_sub$tretetthet025)
browse_sub$tretetthet2549 <- as.numeric(browse_sub$tretetthet2549)
browse_sub$tretetthetpluss50 <- as.numeric(browse_sub$tretetthetpluss50)
browse_sub$tretetthetminus25 <- as.numeric(browse_sub$tretetthetminus25)

```



## Subsetting

Subset of "browse_sub" (several) on 9th and 10th takst
```{r}
browse_910 <- split(browse_sub, browse_sub$takst)

browse_9 <- browse_910[['9']]
browse_10 <- browse_910[['10']]


save(browse_9, file = "browse_9.rda")
save(browse_10, file = "browse_10.rda")


browse_9 <- browse_9[,c(1:8,10:18,26:28,32:39,41:46,48:52,58:61,68:74,79:82,89)]

browse9bro <- browse_9[,c(1:8, 28, 35, 40:55)] # for browsing pressure response
browse9tree <- browse_9[,c(1:8, 10:12, 28, 32, 35:36, 40:54)] # for tree density/ number response

# browse_9$elgROSprs9 <- NULL
# browse_9$elgLAUVprs9 <- NULL
# browse_9$elgFURUprs9 <- NULL


```

Creating subsets for different data
```{r}

browse9bro_disthus <- browse9bro[which(browse9bro$distvei1 < 1501 & browse9bro$disthus > 499), ] # longest distance to any road (that is further than 500m from a house) 1500m

browse9bro_dist <- browse9bro[browse9bro$distvei1 < 1501, ] # longest distance to any public road 1500m


# 
# browse2000 <- browse_sub[browse_sub$disthouse < 2001, ] # longest distance to house 2000m
# browse1500 <- browse_sub[browse_sub$distroad500 < 1501, ] # longest distance to any road (that is further than 500m from a house) 1500m
# browse1500pub <- browse_sub[browse_sub$distpubroad500 < 1501, ] # longest distance to public roads (that are further than 500m from a house) 1500m
# 
# browseros <- browse2000[browse2000$treegroup=="raw", ]
# browserosdistroad <- browse1500[browse1500$treegroup=="raw", ]
# browserosdistpubroad <- browse1500pub[browse1500pub$treegroup=="raw", ]
# 
# 
# 
# browse2000 <- browse_sub[browse_sub$disthouse < 2001, ] # longest distance to house 2000m
# browse1500 <- browse_sub[browse_sub$distroad500 < 1501, ] # longest distance to any road (that is further than 500m from a house) 1500m
# # browse1500pub <- browse_sub[browse_sub$distpubroad500 < 1501, ] # longest distance to public roads (that are further than 500m from a house) 1500m
# 
# browseroad1500 <- browse_sub[browse_sub$distroad1 < 1501, ]
# broad1500house500 <- browse_sub[which(browse_sub$distroad1 < 1501 & browse_sub$disthouse > 499), ]
# 
# browse9_dist <- browse_9[which(browse_9$distvei1 < 1501 & browse_9$disthus > 499), ] # longest distance to any road (that is further than 500m from a house) 1500m
# browse10_dist <- browse_10[which(browse_10$distvei1 < 1501 & browse_10$disthus > 499), ] # longest distance to any road (that is further than 500m from a house) 1500m
# 
# browse9_dist2 <- browse_9[which(browse_9$distvei1 < 1501 & browse_9$disthus > 499 & browse_9$elgbROSprs9 < 101), ] # longest distance to any road (that is further than 500m from a house) 1500m and browsingpressure is under 101%
# 
# # browseros <- browse2000[browse2000$treegroup=="raw", ]
# # browserosdistroad <- browse1500[browse1500$treegroup=="raw", ]
# # browserosdistpubroad <- browse1500pub[browse1500pub$treegroup=="raw", ]

names(browseroad1500)
head(broad1500house500)

save(browseroad1500, file = "browseroad1500.rda")

```



## For browse_9

##### Explore NAs 
```{r}

nrow(browse_9)
nrow(na.omit(browse_9))

head(browse_9, n = 10)
tail(browse_9, n = 10)
# unique(unlist(lapply(browse_9, function (x) which(is.na(x)))))
# fdata1[102, ]

# browse_9$distvei1[is.na(browse_9$distvei1)] <- 10000
# browse_9$distvei2[is.na(browse_9$distvei2)] <- 10000
# browse_9$distvei3[is.na(browse_9$distvei3)] <- 10000

browse_9 <- na.omit(browse_9)

save(browse_9, file = "browse_9.rda")
load("processdata/browse_9.rda")

```

##### Data structure -> factor levels
```{r}

ggplot(data = browse_9, aes(landsdel)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse_9, aes(skogkategori)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse_9, aes(kant)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse_9, aes(treartgruppe)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse_9, aes(hohkatb)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse_9, aes(region)) +
  geom_bar()+
  theme_classic()

```

```{r}

browse_9$beitetrykkr <- as.integer(round(browse_9$beitetrykk))
browse_9$bt100 <- browse_9$beitetrykkr/100
```

```{r}
# browse_9$landsdel <- as.factor(browse_9$landsdel)
# browse_9$hohkatb <- as.factor(browse_9$hohkatb)
# browse_9$landsdel <- factor(browse_9$landsdel, levels = c("Sørlandet", "Østlandet-Øst", "Midt-Norge", "Nord-Norge", "Vestlandet", "Østlandet-vest"))
browse_9$skogkategori <- factor(browse_9$skogkategori, levels = c("Lavproduktiv_eldreskog", "Høyproduktiv_eldreskog", "Høyproduktiv_ungskog",  "Lavproduktiv_ungskog", "Uproduktiv_skog"))
browse_9$kant <- factor(browse_9$kant, levels = c("kant >20m", "kant <10m", "kant 10-20m", "mangler kant")) 
browse_9$treartgruppe <- factor(browse_9$treartgruppe, levels = c("LAUV", "BJORK", "FURU", "ROS"))
# browse_9$hohkatb <- factor(browse_9$hohkatb, levels = c("100", "0", "200", "300", "400", "500", "600", "700", "800"))
browse_9$region <- factor(browse_9$region, levels = c("Agder", "Buskerud", "Hordaland", "Hedmark", "More og Romsdal", "Nord-Trondelag", "Nordland", "Oppland", "Ostfold-Akershus", "Rogaland", "Sogn og Fjordane", "Sor-Trondelag", "Troms", "Vestfold-Telemark"))

```

```{r}
save(browse_9, file = "browse_9.rda")
```


##### Subset
```{r}

browse_9$disthus_cut210 <- ifelse(browse_9$disthus >= 210, 210, browse_9$disthus)

browse_9_dist <- browse_9[browse_9$distvei1 > 210, ] # longest distance to any public road 1500m
head(browse_9_dist)
save(browse_9_dist, file = "browse_9_dist.rda")

```





## For browse9bro

##### Explore NAs 
```{r}

nrow(browse9bro)
nrow(na.omit(browse9bro))

head(browse9bro, n = 10)
tail(browse9bro, n = 10)
# unique(unlist(lapply(browse9bro, function (x) which(is.na(x)))))
# fdata1[102, ]

# browse9bro$distvei1[is.na(browse9bro$distvei1)] <- 10000
# browse9bro$distvei2[is.na(browse9bro$distvei2)] <- 10000
# browse9bro$distvei3[is.na(browse9bro$distvei3)] <- 10000

browse9bro <- na.omit(browse9bro)

save(browse9bro, file = "browse9bro.rda")
load("browse9bro.rda")

```

##### Data structure -> factor levels
```{r}

ggplot(data = browse9bro, aes(landsdel)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro, aes(skogkategori)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro, aes(kant)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro, aes(treartgruppe)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro, aes(hohkatb)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro, aes(region)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro, aes(vegetasjon)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro, aes(veitype1)) +
  geom_bar()+
  theme_classic()

```



```{r}
browse9bro$beitetrykkr <- round(browse9bro$beitetrykk)
```

```{r}
browse9bro$landsdel <- as.factor(browse9bro$landsdel)
browse9bro$hohkatb <- as.factor(browse9bro$hohkatb)
browse9bro$landsdel <- factor(browse9bro$landsdel, levels = c("Vestlandet", "Sørlandet", "Østlandet-Øst", "Midt-Norge", "Nord-Norge", "Østlandet-vest"))
browse9bro$skogkategori <- factor(browse9bro$skogkategori, levels = c("Lavproduktiv_eldreskog", "Høyproduktiv_eldreskog", "Høyproduktiv_ungskog",  "Lavproduktiv_ungskog", "Uproduktiv_skog"))
browse9bro$kant <- factor(browse9bro$kant, levels = c("kant >20m", "kant <10m", "kant 10-20m", "mangler kant")) 
browse9bro$treartgruppe <- factor(browse9bro$treartgruppe, levels = c("LAUV", "BJORK", "FURU", "ROS"))
browse9bro$hohkatb <- factor(browse9bro$hohkatb, levels = c("100", "0", "200", "300", "400", "500", "600", "700", "800"))
browse9bro$region <- factor(browse9bro$region, levels = c("Agder", "Buskerud", "Hordaland", "Hedmark", "More og Romsdal", "Nord-Trondelag", "Nordland", "Oppland", "Ostfold-Akershus", "Rogaland", "Sogn og Fjordane", "Sor-Trondelag", "Troms", "Vestfold-Telemark"))
browse9bro$vegetasjon <- as.factor(browse9bro$vegetasjon)
browse9bro$vegetasjon <- factor(browse9bro$vegetasjon, levels = c("Blaabaerskog", "Alm-lindeskog", "Baerlyngskog", "Berg-grus",  "Blokkebaerskog", "Flommarkskog", "Graaorskog", "Hagemarkskog", "Hogstaudeskog", "Kystlynghei", "Laagurtskog", "Lavskog", "Myr-myrskog", "Or-askeskog", "Smaabregneskog", "Storbregneskog", "Viersumpskog"))
browse9bro$veitype1 <- as.factor(browse9bro$veitype1)
browse9bro$veitype1 <- factor(browse9bro$veitype1, levels = c("fylkesveg", "europaogriksveg", "kommuneveg"))
```

```{r}
save(browse9bro, file = "browse9bro.rda")
```




# For browse9bro_dist

##### Data structure -> factor levels
```{r}

ggplot(data = browse9bro_dist, aes(landsdel)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro_dist, aes(skogkategori)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro_dist, aes(kant)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro_dist, aes(treartgruppe)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro_dist, aes(hohkatb)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro_dist, aes(region)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro_dist, aes(vegetasjon)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro_dist, aes(veitype1)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9bro_dist, aes(helling)) +
  geom_bar()+
  theme_classic()

```

```{r}
browse9bro_dist$landsdel <- as.factor(browse9bro_dist$landsdel)
browse9bro_dist$hohkatb <- as.factor(browse9bro_dist$hohkatb)
browse9bro_dist$landsdel <- factor(browse9bro_dist$landsdel, levels = c("Vestlandet", "Sørlandet", "Østlandet-Øst", "Midt-Norge", "Nord-Norge", "Østlandet-vest"))
browse9bro_dist$skogkategori <- factor(browse9bro_dist$skogkategori, levels = c("Lavproduktiv_eldreskog", "Høyproduktiv_eldreskog", "Høyproduktiv_ungskog",  "Lavproduktiv_ungskog", "Uproduktiv_skog"))
browse9bro_dist$kant <- factor(browse9bro_dist$kant, levels = c("kant >20m", "kant <10m", "kant 10-20m", "mangler kant")) 
browse9bro_dist$treartgruppe <- factor(browse9bro_dist$treartgruppe, levels = c("LAUV", "BJORK", "FURU", "ROS"))
browse9bro_dist$hohkatb <- factor(browse9bro_dist$hohkatb, levels = c("100", "0", "200", "300", "400", "500", "600", "700", "800"))
browse9bro_dist$region <- factor(browse9bro_dist$region, levels = c("Agder", "Buskerud", "Hordaland", "Hedmark", "More og Romsdal", "Nord-Trondelag", "Nordland", "Oppland", "Ostfold-Akershus", "Rogaland", "Sogn og Fjordane", "Sor-Trondelag", "Troms", "Vestfold-Telemark"))
browse9bro_dist$vegetasjon <- as.factor(browse9bro_dist$vegetasjon)
browse9bro_dist$vegetasjon <- factor(browse9bro_dist$vegetasjon, levels = c("Blaabaerskog", "Alm-lindeskog", "Baerlyngskog", "Berg-grus",  "Blokkebaerskog", "Flommarkskog", "Graaorskog", "Hagemarkskog", "Hogstaudeskog", "Kystlynghei", "Laagurtskog", "Lavskog", "Myr-myrskog", "Or-askeskog", "Smaabregneskog", "Storbregneskog", "Viersumpskog"))
browse9bro_dist$veitype1 <- as.factor(browse9bro_dist$veitype1)
browse9bro_dist$veitype1 <- factor(browse9bro_dist$veitype1, levels = c("fylkesveg", "europaogriksveg", "kommuneveg"))
browse9bro_dist$helling <- as.factor(browse9bro_dist$helling)
```

```{r}
save(browse9bro_dist, file = "browse9bro_dist.rda")
```


For binary logistic regression
```{r}
browse9bro_dist$nobro <- 100-browse9bro_dist$beitetrykkr
browse9bro_dist$nobro <- as.integer(browse9bro_dist$nobro)
browse9bro_dist$beitetrykkr <- as.integer(browse9bro_dist$beitetrykkr)
```


For beta regression
```{r}
browse9bro_dist$bt100 <- browse9bro_dist$beitetrykkr/100

browse9bro_disthus$bt100 <- browse9bro_disthus$beitetrykk/100



browse9bro_dist$bt100[browse9bro_dist$bt100 == 0.00] <- 0.01   # ---- use this to run a normal beta regression, which cannot handle values of 0.0

str(browse9bro_dist$bt100)


```


For binomial
```{r}
browse9bro_dist$btbinary <- browse9bro_dist$beitetrykkr

browse9bro_dist$btbinary[browse9bro_dist$btbinary > 0] <- 1

str(browse9bro_dist$btbinary)


```


## For browse_9_dist

##### Data structure -> factor levels
```{r}

ggplot(data = browse_9_dist, aes(skogkategori)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse_9_dist, aes(kant)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse_9_dist, aes(treartgruppe)) +
  geom_bar()+
  theme_classic()


ggplot(data = browse_9_dist, aes(region)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse_9_dist, aes(KOMNR)) +
  geom_bar()+
  theme_classic()



```

```{r}
str(browse_9_dist$skogkategori)
str(browse_9_dist$kant)
str(browse_9_dist$treartgruppe)
str(browse_9_dist$region)

```

```{r}
browse_9_dist$skogkategori <- as.factor(browse_9_dist$skogkategori)
levels(browse_9_dist$skogkategori)
browse_9_dist$skogkategori <- factor(browse_9_dist$skogkategori, levels = c("Lavproduktiv_eldreskog", "Høyproduktiv_eldreskog", "Høyproduktiv_ungskog",  "Lavproduktiv_ungskog", "Uproduktiv_skog"))
levels(browse_9_dist$skogkategori)

browse_9_dist$kant <- as.factor(browse_9_dist$kant)
levels(browse_9_dist$kant)
browse_9_dist$kant <- factor(browse_9_dist$kant, levels = c("kant >20m", "kant <10m", "kant 10-20m", "mangler kant")) 
levels(browse_9_dist$kant)

browse_9_dist$treartgruppe <- as.factor(browse_9_dist$treartgruppe)
levels(browse_9_dist$treartgruppe)
browse_9_dist$treartgruppe <- factor(browse_9_dist$treartgruppe, levels = c("LAUV", "FURU", "ROS")) 
levels(browse_9_dist$treartgruppe)

browse_9_dist$region <- as.factor(browse_9_dist$region)
levels(browse_9_dist$region)

browse_9_dist$KOMNR <- as.factor(browse_9_dist$KOMNR)
levels(browse_9_dist$KOMNR)

```












## For browse9tree ------------------>  NB! not run yet!!!

##### Explore NAs 
```{r}

nrow(browse9tree)
nrow(na.omit(browse9tree))

head(browse9tree, n = 10)
tail(browse9tree, n = 10)
# unique(unlist(lapply(browse9tree, function (x) which(is.na(x)))))
# fdata1[102, ]

# browse9tree$distvei1[is.na(browse9tree$distvei1)] <- 10000
# browse9tree$distvei2[is.na(browse9tree$distvei2)] <- 10000
# browse9tree$distvei3[is.na(browse9tree$distvei3)] <- 10000

browse9tree <- na.omit(browse9tree)

save(browse9tree, file = "browse9tree.rda")
load("browse9tree.rda")

```

##### Data structure -> factor levels
```{r}

ggplot(data = browse9tree, aes(landsdel)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9tree, aes(skogkategori)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9tree, aes(kant)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9tree, aes(treartgruppe)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9tree, aes(hohkatb)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9tree, aes(region)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9tree, aes(vegetasjon)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse9tree, aes(veitype1)) +
  geom_bar()+
  theme_classic()

```



```{r}
browse9tree$beitetrykkr <- round(browse9tree$beitetrykk)
```

```{r}
browse9tree$landsdel <- as.factor(browse9tree$landsdel)
browse9tree$hohkatb <- as.factor(browse9tree$hohkatb)
browse9tree$landsdel <- factor(browse9tree$landsdel, levels = c("Vestlandet", "Sørlandet", "Østlandet-Øst", "Midt-Norge", "Nord-Norge", "Østlandet-vest"))
browse9tree$skogkategori <- factor(browse9tree$skogkategori, levels = c("Lavproduktiv_eldreskog", "Høyproduktiv_eldreskog", "Høyproduktiv_ungskog",  "Lavproduktiv_ungskog", "Uproduktiv_skog"))
browse9tree$kant <- factor(browse9tree$kant, levels = c("kant >20m", "kant <10m", "kant 10-20m", "mangler kant")) 
browse9tree$treartgruppe <- factor(browse9tree$treartgruppe, levels = c("LAUV", "BJORK", "FURU", "ROS"))
browse9tree$hohkatb <- factor(browse9tree$hohkatb, levels = c("100", "0", "200", "300", "400", "500", "600", "700", "800"))
browse9tree$region <- factor(browse9tree$region, levels = c("Agder", "Buskerud", "Hordaland", "Hedmark", "More og Romsdal", "Nord-Trondelag", "Nordland", "Oppland", "Ostfold-Akershus", "Rogaland", "Sogn og Fjordane", "Sor-Trondelag", "Troms", "Vestfold-Telemark"))
browse9tree$vegetasjon <- as.factor(browse9tree$vegetasjon)
browse9tree$vegetasjon <- factor(browse9tree$vegetasjon, levels = c("Blaabaerskog", "Alm-lindeskog", "Baerlyngskog", "Berg-grus",  "Blokkebaerskog", "Flommarkskog", "Graaorskog", "Hagemarkskog", "Hogstaudeskog", "Kystlynghei", "Laagurtskog", "Lavskog", "Myr-myrskog", "Or-askeskog", "Smaabregneskog", "Storbregneskog", "Viersumpskog"))
browse9tree$veitype1 <- as.factor(browse9tree$veitype1)
browse9tree$veitype1 <- factor(browse9tree$veitype1, levels = c("fylkesveg", "europaogriksveg", "kommuneveg"))
```

```{r}
save(browse9tree, file = "browse9tree.rda")
```










