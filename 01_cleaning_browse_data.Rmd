---
title: "01_cleaning_browse_data"
author: "anne"
date: "31 oktober 2018"
output: word_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
load("processdata/browse.rda")
load("processdata/browse_sub.rda")
```

## Cleaning data
```{r}
str(browse)
head(browse)
names(browse)

```

Create a subset of browse with less variables
```{r}
browse_sub  <- browse[,c(1:5,7:10,12:25,27:45,49,51,53:54,59,62:68,70:82,87:88,96:104,109:119)]
head(browse_sub, n = 3)
write.csv(browse_sub, file = "browse_sub.csv")

# browse_sub <- read_csv("processdata/browse_sub.csv", + na = "NA")
save(browse_sub, file = "browse_sub.rda")


load("processdata/browse_sub.rda")
names(browse_sub)
```


```{r}
dim(browse_sub)
str(browse_sub)
head(browse_sub)

```

##### change structure (numeric, integer, factor; also level names for factors)
```{r}
# col. names
colnames(browse_sub)[68] <- "foresttype"
colnames(browse_sub)[89] <- "distpubroad500"

# structure
browse_sub$pubescens.prha <- as.integer(browse_sub$pubescens.prha)
browse_sub$rowan.prha <- as.integer(browse_sub$rowan.prha)
browse_sub$aspen.prha <- as.integer(browse_sub$aspen.prha)
browse_sub$spruce.prha <- as.integer(browse_sub$spruce.prha)
browse_sub$oakprha <- as.integer(browse_sub$oakprha)
browse_sub$pine.prha <- as.integer(browse_sub$pine.prha)
browse_sub$other.prha <- as.integer(browse_sub$other.prha)


# level names
levels(browse_sub$region) <- c("Agder","Buskerud","Hedmark","Hordaland","More.Romsdal","Nord.Trondelag","Nordland","Oppland", "Ostfold.Akershus","Rogaland","Sogn.Fjordane","Sor.Trondelag","Troms","Vestfold.Telemark")
levels(browse_sub$roadtype1) <- c("blanks","stateroad", "countyroad", "municipalityroad") 
levels(browse_sub$roadtype2) <- c("blanks","stateroad", "countyroad", "municipalityroad","privateroad") 
levels(browse_sub$roadtype3) <- c("blanks","stateroad", "countyroad", "municipalityroad","privateroad", "forestroad") 
levels(browse_sub$treegroup) <- c("birch","pine","deciduous","ros")
levels(browse_sub$landsdel) <- c("Midt.Norge","Nord.Norge","Soerlandet","Vestlandet","Oestlandet.vest", "Oestlandet.oest")
levels(browse_sub$foresttype) <- c("old.high.productive", "young.high.productive","old.low.productive","young.low.productive", "unproductive")

broadhouse9$foresttype <- factor(broadhouse9$foresttype, levels = c("unproductive", "old.high.productive", "young.high.productive", "old.low.productive", "young.low.productive"))
broadhouse9$landsdel <- factor(broadhouse9$landsdel, levels = c("Vestlandet", "Midt.Norge", "Nord.Norge", "Soerlandet", "Oestlandet.vest", "Oestlandet.oest"))
broadhouse9$edge <-factor(broadhouse9$edge, levels = c("kant >20m", "kant <10m", "kant 10-20m", "mangler kant")) 

broadhouse10$foresttype <- factor(broadhouse10$foresttype, levels = c("unproductive", "old.high.productive", "young.high.productive", "old.low.productive", "young.low.productive"))
levels(broadhouse10$landsdel) <- c("Vestlandet", "Midt.Norge", "Nord.Norge", "Soerlandet", "Oestlandet.vest", "Oestlandet.oest")
broadhouse10$edge <-factor(broadhouse10$edge, levels = c("kant >20m", "kant <10m", "kant 10-20m", "mangler kant")) 

```

##### Explore NAs
```{r}
nrow((browse_sub))
nrow(na.omit(browse_sub))
  
anyNA(browse_sub$bros10)
anyNA(browse_sub$bros9)
anyNA(browse_sub$birch10)
anyNA(browse_sub$bdec9)
anyNA(browse_sub$bpine10)
anyNA(browse_sub$bpine9)
anyNA(browse_sub$roadtype1)
anyNA(browse_sub$roadtype2)
anyNA(browse_sub$roadtype3)
anyNA(browse_sub$roadtype3)


mean(is.na(browse_sub$bros10))
mean(is.na(browse_sub$bros9))
sum(is.na(browse_sub$bros10))
sum(is.na(browse_sub$bros9))

sum(is.na(browse_sub$bros10[is.na(browse_sub$bros10) & browse_sub$year > 2010]))
sum(is.na(browse_sub$bros9[is.na(browse_sub$bros9) & browse_sub$year < 2009]))

```



```{r}
table(browse_sub$roadtype1)
table(browse_sub$roadtype2)
table(browse_sub$roadtype3)

table(broadhouse10$landsdel)
table(broadhouse10$foresttype)
table(broadhouse10$edge)

```
```{r}
ggplot(data = broad1500house2000, aes(roadtype1)) +
  geom_bar()+
  theme_classic()

ggplot(data = broad1500house2000, aes(treegroup)) +
  geom_bar()+
  theme_classic()

ggplot(data = browse_origin, aes(treartgruppe)) +
  geom_bar()+
  theme_classic()

ggplot(data = broad1500house2000, aes(foresttype)) +
  geom_bar()+
  theme_classic()


ggplot(data = broadhouse9, aes(distroad1)) +
  geom_histogram()+
  theme_classic()

ggplot(data = broadhouse9, aes(roadtype1)) +
  geom_bar()+
  theme_classic()

ggplot(data = broadhouse9, aes(treegroup)) +
  geom_bar()+
  theme_classic()

ggplot(data = broadhouse9, aes(landsdel)) +
  geom_bar()+
  theme_classic()

ggplot(data = broadhouse9, aes(foresttype)) +
  geom_bar()+
  theme_classic()

ggplot(data = broadhouse9, aes(edge)) +
  geom_bar()+
  theme_classic()
```





## Subsetting

Subset of browse_sub on 9th and 10th takst
```{r}
browse_sub910 <- split(browse_sub, browse_sub$takst)

browse_sub9 <- browse_sub910[['9']]
browse_sub10 <- browse_sub910[['10']]

save(browse_sub9, file = "browse_sub9.rda")
save(browse_sub10, file = "browse_sub10.rda")

```




Creating subsets for different data
```{r}
browse2000 <- browse_sub[browse_sub$disthouse < 2001, ] # longest distance to house 2000m
browse1500 <- browse_sub[browse_sub$distroad500 < 1501, ] # longest distance to any road (that is further than 500m from a house) 1500m
browse1500pub <- browse_sub[browse_sub$distpubroad500 < 1501, ] # longest distance to public roads (that are further than 500m from a house) 1500m

browseros <- browse2000[browse2000$treegroup=="raw", ]
browserosdistroad <- browse1500[browse1500$treegroup=="raw", ]
browserosdistpubroad <- browse1500pub[browse1500pub$treegroup=="raw", ]
```






