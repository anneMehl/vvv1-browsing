---
title: "09_total_path_effect"
author: "anne"
date: "29 august 2019"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
library(lme4)
library(glmmTMB)
```


## Browsing pressure
#### Houses
```{r}
load("output/m1kbin2.rda")
zeromod1 <- m1kbin2

load("output/m1ibeta2.rda")
percmod1 <- m1ibeta2

load("processdata/browse9.4_house.rda")
dat1 <- browse9.4_house
```

#### Roads
```{r}
load("output/m4abin2.rda")
zeromod1 <- m4abin2
# summary(zeromod1)

load("output/m4abeta2.rda")
percmod1 <- m4abeta2 
# summary(percmod1)

load("processdata/browse9.4.rda")
# head(browse9.4)
dat1 <- browse9.4
```



## Recruits
#### Houses
```{r}
load("output/mhusabin.rda")
zeromod2 <- mhusabin

# mhusabin <- glmer(factor(proplt > 0) ~ disthus_400 + log(distvei2+1) + skogkategori + treartgruppe9 + browspres_merged + kant + helling + HOH + I(HOH^2) +  ac + (1|KOMNR),
# family = binomial(),
# data = browse9.5msc)

load("output/m16abeta_house.rda")
percmod2 <- m16abeta_house

# m16beta_house <- glmmTMB(proplt ~ log(distvei2+1) + skogkategori + treartgruppe9 + HOH + I(HOH^2) + browspres_merged + (1|KOMNR),
#             data = browse9.5mpossc,
#             family = beta_family())

load("processdata/browse9.5msc.rda")
dat2 <- browse9.5msc

```

#### Roads
```{r}
library(fitdistrplus)
descdist(browse9.6sc$proplt, discrete=FALSE, boot=500)

load("output/m2bin_roads.rda")
zeromod2 <- m2bin_roads
# summary(m2bin_roads)

# m2bin_roads <- glmer(factor(proplt > 0) ~ log(distvei2+1) + skogkategori + treartgruppe9 + browspres_merged + helling + HOH + I(HOH^2) +  ac + (1|KOMNR),
# family = binomial(),
# data = browse9.6sc)

load("output/m3betaroad.rda")
percmod2 <- m3betaroad

# m3betaroad <- glmmTMB(proplt ~ skogkategori + treartgruppe9 + ac + helling + HOH + I(HOH^2) + browspres_merged + (1|KOMNR),
#             data = browse9.6scpos,
#             family = beta_family())

load("processdata/browse9.6sc.rda")
# head(browse9.6sc)
dat2 <- browse9.6sc
```




## Load and run function
```{r}
source("function_resp_curve.R")
```

```{r}
(focal = c("distvei", "skogkategori", "treartgruppe", "kant", 
           "helling", "HOH", "tretetthet", "browspres_merged", "disthus")[7])

```

#### Run function for the different models/ focals and SAVE them
```{r}
recruit_bp <- resp_curve(focal, dat1, dat2, zeromod1, percmod1, zeromod2, percmod2, 
           which_effect=c("hurdle1_only", "hurdle2_only", "total")[2], nvals=100, plotit=F, nb_btstrp=99)

recruit_distvei <- resp_curve(focal, dat1, dat2, zeromod1, percmod1, zeromod2, percmod2, 
           which_effect=c("hurdle1_only", "hurdle2_only", "total")[2], nvals=100, plotit=T, nb_btstrp=99)

total_tretett <- resp_curve(focal, dat1, dat2, zeromod1, percmod1, zeromod2, percmod2, 
           which_effect=c("hurdle1_only", "hurdle2_only", "total")[3], nvals=100, plotit=F, nb_btstrp=99)
```

#### Save function data!
```{r}
save(total_tretett, file = "total_tretett.rda")
```




## load function data
```{r}
# Browsing pressure (indirect)
load("output/final_function_outputs/bp_disthus.rda")
load("output/final_function_outputs/bp_distvei.rda")
load("output/final_function_outputs/bp_skogkat.rda")
load("output/final_function_outputs/bp_kant.rda")
load("output/final_function_outputs/bp_treart.rda")
load("output/final_function_outputs/bp_hell.rda")
load("output/final_function_outputs/bp_hoh.rda")
load("output/final_function_outputs/bp_tretett.rda")

# Recruits (direct)
load("output/final_function_outputs/06012020/recruit_disthus.rda")
load("output/final_function_outputs/06012020/recruit_distvei.rda")
load("output/final_function_outputs/06012020/recruit_skogkat.rda")
load("output/final_function_outputs/06012020/recruit_kant.rda")
load("output/final_function_outputs/06012020/recruit_treart.rda")
load("output/final_function_outputs/06012020/recruit_hell.rda")
load("output/final_function_outputs/06012020/recruit_bp.rda")
load("output/final_function_outputs/06012020/recruit_hoh.rda")

# Total (indirect + direct)
load("output/final_function_outputs/06012020/total_disthus.rda")
load("output/final_function_outputs/06012020/total_distvei.rda")
load("output/final_function_outputs/06012020/total_skogkat.rda")
load("output/final_function_outputs/06012020/total_kant.rda")
load("output/final_function_outputs/06012020/total_treart.rda")
load("output/final_function_outputs/06012020/total_hell.rda")
load("output/final_function_outputs/06012020/total_bp.rda")
load("output/final_function_outputs/06012020/total_tretett.rda")
load("output/final_function_outputs/06012020/total_hoh.rda")


```


## Re-scale (now should already be done for all variables, if the loaded function data is used)
```{r}
# attributes(browse9.2$HOH_scale)
# attributes(browse9.2$disthus_trunc_cut200_scale)
# 
# d$s.x * attr(d$s.x, 'scaled:scale') + attr(d$s.x, 'scaled:center')

# disthus
bp_disthus$var <- bp_disthus$var * 27.71453 + 192.2636
recruit_disthus$var <- recruit_disthus$var * 88.52122 + 358.5594
total_disthus$var <- total_disthus$var * 88.52122 + 358.5594 

# road models
bp_distvei$var <- exp(bp_distvei$var)-1

bp_hoh$var <- bp_hoh$var * 244.7748 + 361.8423


recruit_distvei$var <- exp(recruit_distvei$var)-1

recruit_HOH$var <- recruit_HOH$var * 244.7748 + 361.8423


total_distvei$var <- exp(total_distvei$var)-1

total_HOH$var <- total_HOH$var * 244.7748 + 361.8423




```

```{r}

d$s.x * attr(d$s.x, 'scaled:scale') + attr(d$s.x, 'scaled:center')


# BP
h1_disthus$var <- h1_disthus$var * 27.71453 + 192.2636
h1_distvei$var <- exp(h1_distvei$var)-1
h1_hoh$var <- h1_hoh$var * 244.7748 + 361.8423


# Trees
h2_disthus$var <- h2_disthus$var * 88.5 + 359
h2_distvei$var <- exp(h2_distvei$var)-1
# h2_hell$var <- h2_hell$var * 19.4 + 18.7
h2_hoh$var <- h2_hoh$var * 243 + 407


# Total
tt_disthus$var <- tt_disthus$var * 88.5 + 359
tt_distvei$var <- exp(tt_distvei$var)-1
# tt_hell$var <- tt_hell$var * 19.4 + 18.7
tt_hoh$var <- tt_hoh$var * 243 + 407


```



## Plots
```{r}
library(ggplot2)

# disthus ----
pdt_disthus <- ggplot() + 
  geom_line(data = total_disthus, aes(var, point, color = "total"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_disthus, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 0, alpha = 0.2) +
  geom_line(data = recruit_disthus, aes(var, point, color = "direct\n(only on\nprobability)"), linetype = 2, size = 1, show.legend = T) +
  geom_ribbon(data = recruit_disthus, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 0, alpha = 0.2) +
  xlab("\nDistance to house (m)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct\n(only on\nprobability)" = "#004949"))

pt_disthus <- ggplot() + 
  geom_line(data = total_disthus, aes(var, point, color = "total"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_disthus, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nDistance to house (m)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

pd_disthus <- ggplot() + 
  geom_line(data = recruit_disthus, aes(var, point, color = "direct"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = recruit_disthus, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nDistance to house (m)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

ph_disthus <- ggplot(data = bp_disthus, aes(var, point)) +
  geom_line(colour = "#009292", linetype = 1, size = 1)+
  geom_ribbon(aes(ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nDistance to house (m)") + 
  ylab("Browsing pressure (%)\n") 

# distvei ----
pdt_distvei <- ggplot() + 
  geom_line(data = total_distvei, aes(var, point, color = "total"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_distvei, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 0, alpha = 0.2) +
  geom_line(data = recruit_distvei, aes(var, point, color = "direct\n(only on\nprobability)"), linetype = 2, size = 1, show.legend = T) +
  geom_ribbon(data = recruit_distvei, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 0, alpha = 0.2) +
  xlab("\nDistance to road (m)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct\n(only on\nprobability" = "#004949"))

pt_distvei <- ggplot() + 
  geom_line(data = total_distvei, aes(var, point, color = "total"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_distvei, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nDistance to road (m)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

pd_distvei <- ggplot() + 
  geom_line(data = recruit_distvei, aes(var, point, color = "direct"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = recruit_distvei, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nDistance to road (m)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

ph_distvei <- ggplot(data = bp_distvei, aes(var, point)) +
  geom_line(colour = "#009292", linetype = 1, size = 1)+
  geom_ribbon(aes(ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nDistance to road (m)") + 
  ylab("Browsing pressure (%)\n") 

# skogkat ----
pdt_skogkat <- ggplot() +
  geom_pointrange(data = recruit_skogkat, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "direct"), size = 1) +
  theme_light() +
  geom_pointrange(data = total_skogkat, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "total"), size = 1) +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nForest category") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Highproductive \nold forest", "Highproductive \nyoung forest", "Lowproductive \nold forest", "Lowproductive \nyoung forest", "Unproductive \nforest"))+
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

pt_skogkat <- ggplot() +
  geom_pointrange(data = total_skogkat, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "total"), size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nForest category") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Highproductive \nold forest", "Highproductive \nyoung forest", "Lowproductive \nold forest", "Lowproductive \nyoung forest", "Unproductive \nforest"))+
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

pd_skogkat <- ggplot() +
  geom_pointrange(data = recruit_skogkat, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "direct"), size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nForest category") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Highproductive \nold forest", "Highproductive \nyoung forest", "Lowproductive \nold forest", "Lowproductive \nyoung forest", "Unproductive \nforest"))+
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

ph_skogkat <- ggplot(data = bp_skogkat,aes(var, point)) +
  geom_pointrange(aes(ymin = CI025, ymax = CI975), colour = "#009292", size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nForest category") + 
  ylab("Browsing pressure (%)\n") +
  scale_x_discrete(labels = c("Highproductive \nold forest", "Highproductive \nyoung forest", "Lowproductive \nold forest", "Lowproductive \nyoung forest", "Unproductive \nforest")) 

# treart ----
pdt_treart <- ggplot() +
  geom_pointrange(data = recruit_treart, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "direct"), size = 1) +
  geom_pointrange(data = total_treart, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "total"), size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nTree species group") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Pine", "Other deciduous \ntrees", "Rowan, aspen, \nwillow")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

pt_treart <- ggplot() +
  geom_pointrange(data = total_treart, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "total"), size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nTree species group") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Pine", "Other deciduous \ntrees", "Rowan, aspen, \nwillow")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

pd_treart <- ggplot() +
  geom_pointrange(data = recruit_treart, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "direct"), size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nTree species group") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Pine", "Other deciduous \ntrees", "Rowan, aspen, \nwillow")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

ph_treart <- ggplot(data = bp_treart,aes(var, point)) +
  geom_pointrange(aes(ymin = CI025, ymax = CI975), colour = "#009292", size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nTree species groups") + 
  ylab("Browsing pressure (%)\n") +
  scale_x_discrete(labels = c("Pine", "Other deciduous \ntrees", "Rowan, aspen, \nwillow")) 

# kant ----
pdt_kant <- ggplot() +
  geom_pointrange(data = total_kant, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "indirect"), size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nEdge effect") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Edge <10m", "Edge >20m", "Edge 10-20m", "Edge information\nmissing")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("indirect" = "#009292", "direct" = "#004949"))



pd_kant_TEST <- ggplot() +
  geom_pointrange(data = recruit_kant, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "direct"), size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nTree species group") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Edge <10m", "Edge >20m", "Edge 10-20m", "Edge information\nmissing"))




pt_kant <- ggplot() +
  geom_pointrange(data = total_kant, aes(x = var, y = point, ymin = CI025, ymax = CI975, colour = "indirect"), size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nEdge effect") + 
  ylab("Recruits (%)\n") +
  scale_x_discrete(labels = c("Edge <10m", "Edge >20m", "Edge 10-20m", "Edge information\nmissing")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("indirect" = "#009292", "direct" = "#004949"))

ph_kant <- ggplot(data = bp_kant, aes(var, point)) +
  geom_pointrange(aes(ymin = CI025, ymax = CI975), colour = "#009292", size = 1) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nEdge effect") + 
  ylab("Browsing pressure (%)\n") +
  scale_x_discrete(labels = c("Edge <10m", "Edge >20m", "Edge 10-20m", "Edge information\nmissing"))

# hell ----
pdt_hell <- ggplot() + 
  geom_line(data = total_hell, aes(var, point, color = "total"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_hell, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 0, alpha = 0.2) +
  geom_line(data = recruit_hell, aes(var, point, color = "direct\n(only on\nprobability)"), linetype = 2, size = 1, show.legend = T) +
  geom_ribbon(data = recruit_hell, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 0, alpha = 0.2) +
  xlab("\nSlope (%)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct\n(only on\nprobability)" = "#004949"))

pt_hell <- ggplot() + 
  geom_line(data = total_hell, aes(var, point, color = "total"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_hell, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nSlope (%)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

pd_hell <- ggplot() + 
  geom_line(data = recruit_hell, aes(var, point, color = "direct\n(only on\nprobability)"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = recruit_hell, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nSlope (%)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct\n(only on\nprobability)" = "#004949"))

ph_hell <- ggplot(data = bp_hell,aes(var, point)) +
  geom_line(colour = "#009292", linetype = 1, size = 1)+
  geom_ribbon(aes(ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nSlope (%)") + 
  ylab("Browsing pressure (%)\n")

# hoh ----
pdt_hoh <- ggplot() + 
  geom_line(data = total_HOH, aes(var, point, color = "total"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_HOH, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 0, alpha = 0.2) +
  geom_line(data = recruit_HOH, aes(var, point, color = "direct"), linetype = 2, size = 1, show.legend = T) +
  geom_ribbon(data = recruit_HOH, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 0, alpha = 0.2) +
  xlab("\nAltitude (%)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

pt_hoh <- ggplot() + 
  geom_line(data = total_hoh, aes(var, point, color = "total"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_hoh, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nAltitude (%)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

pd_hoh <- ggplot() + 
  geom_line(data = recruit_hoh, aes(var, point, color = "direct"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = recruit_hoh, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nAltitude (%)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

ph_hoh <- ggplot(data = bp_hoh,aes(var, point)) +
  geom_line(colour = "#009292", linetype = 1, size = 1)+
  geom_ribbon(aes(ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nAltitude (m)") + 
  ylab("Browsing pressure (%)\n")

# tretett ----
pdt_tretett <- ggplot() + 
  geom_line(data = total_tretett, aes(var, point, color = "indirect"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_tretett, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 0, alpha = 0.2) +
  xlab("\nTree density") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("indirect" = "#009292", "direct" = "#004949"))

pt_tretett <- ggplot() + 
  geom_line(data = total_tretett, aes(var, point, color = "indirect"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = total_tretett, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nTree density") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("indirect" = "#009292", "direct" = "#004949"))

ph_tretett <- ggplot(data = bp_tretett,aes(var, point)) +
  geom_line(colour = "#009292", linetype = 1, size = 1)+
  geom_ribbon(aes (ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  theme_light() +
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  xlab("\nTree density") + 
  ylab("Browsing pressure (%)\n")

# beite ----
pdt_beite <- ggplot() + 
  geom_line(data = recruit_bp, aes(var, point, color = "direct"), linetype = 2, size = 1, show.legend = T) +
  geom_ribbon(data = recruit_bp, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 0, alpha = 0.2) +
  xlab("\nBrowsing pressure (%)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

pt_beite <- ggplot() + 
  geom_line(data = recruit_beite, aes(var, point, color = "direct"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = recruit_beite, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nBrowsing pressure (%)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))

pd_beite <- ggplot() + 
  geom_line(data = recruit_beite, aes(var, point, color = "direct"), linetype = 1, size = 1, show.legend = T) +
  geom_ribbon(data = recruit_beite, aes(x = var, ymin = CI025, ymax = CI975), colour = "#004949", linetype = 2, alpha = 0.2) +
  xlab("\nBrowsing pressure (%)") + 
  ylab("Recruits (%)\n") +
  theme_light()+
  theme(axis.text = element_text(size = 10),
        axis.title = element_text(family = "sans", size = 14, color = "grey30")) +
  scale_color_manual(name = "Effect on \nRecruits (%)", 
                     values = c("total" = "#009292", "direct" = "#004949"))


```
#### Plotgrid
```{r}
# library(cowplot)
# plot_grid(p1, p2, p3, p4, p5, p6, p7, p8,
#           nrow = 3, ncol = 3)

library(gridExtra)
# browsing pressure
grid.arrange(ph_disthus, ph_distvei, ph_treart, ph_hell, ph_hoh, ph_kant, ph_skogkat,  ph_tretett,
          nrow = 4, ncol = 2)

# direct
grid.arrange(pd_disthus, pd_distvei, pd_treart, pd_skogkat, pd_hell, pd_hoh, pd_beite,
          nrow = 4, ncol = 2)

# total
grid.arrange(pt_disthus, pt_distvei, pt_beite, pt_treart, pt_skogkat, pt_hell, pt_hoh, pt_kant, pt_tretett,
          nrow = 5, ncol = 2)

# direct and total
grid.arrange(pdt_disthus, pdt_distvei, pdt_beite, pdt_treart, pdt_skogkat, pdt_hell, pdt_hoh, pdt_kant, pdt_tretett,
          nrow = 5, ncol = 2)



```



"#004949", "#009292"


## Testing for kant in total/ indirect effect
```{r}
# BIN
library(lme4)
load("processdata/browse9.6sc.rda")

# m16cbin: glmer(factor(proplt > 0) ~ log(distvei2+1) + skogkategori + treartgruppe9 + kant + helling + HOH + I(HOH^2) +  ac + (1|KOMNR), family = binomial(), data = browse9.6sc)

bin_kant <- glmer(factor(proplt > 0) ~ log(distvei2+1) + skogkategori + treartgruppe9 + kant + helling + HOH + I(HOH^2) +  ac + (1|KOMNR), 
                  family = binomial(), 
                  data = browse9.6sc)


# BETA
library(glmmTMB)
load("processdata/browse9.5mpossc.rda")

# m16abeta: glmmTMB(proplt ~ log(distvei2+1) + skogkategori + treartgruppe9 + HOH + I(HOH^2) + browspres_merged + (1|KOMNR), data = browse9.5mpossc, family = beta_family())

beta_kant <- glmmTMB(proplt ~ log(distvei2+1) + skogkategori + treartgruppe9 + HOH + I(HOH^2) + kant + (1|KOMNR), data = browse9.5mpossc, family = beta_family())


```



## Testing R2 and AIC weight for best models and model without dist house/ dist road
```{r}

# HOUSE ----
load("processdata/browse9.5msc.rda")
load("processdata/browse9.5mpossc.rda")
#bin
library(lme4)
load("output/mhusabin.rda")

mhusabin_2 <- glmer(factor(proplt > 0) ~ log(distvei2+1) + skogkategori + treartgruppe9 + browspres_merged + kant + helling + HOH + I(HOH^2) +  ac + (1|KOMNR),
family = binomial(),
data = browse9.5msc)

#       K     AICc Delta_AICc AICcWt Cum.Wt       LL
# Mod1 17 14213.08       0.00   0.97   0.97 -7089.51
# Mod2 16 14220.23       7.15   0.03   1.00 -7094.09
# Mod 1 = mhusabin

# beta
library(glmmTMB)
load("output/m16abeta_house.rda")

m16abeta_house2 <- glmmTMB(proplt ~ log(distvei2+1) + skogkategori + treartgruppe9 + HOH + I(HOH^2) + browspres_merged + (1|KOMNR),
            data = browse9.5mpossc,
            family = beta_family())

#                 dAIC df weight
# m16abeta_house   0.0 12 0.5   
# m16abeta_house2  0.0 12 0.5   
# > AIC(m16abeta_house, m16abeta_house2)
#                 df      AIC
# m16abeta_house  12 -809.593
# m16abeta_house2 12 -809.593
# The original model is already without distance to houses...

# ROAD ----
load("processdata/browse9.6sc.rda")
load("processdata/browse9.6scpos.rda")
# bin
library(lme4)
load("output/m2bin_roads.rda")

m2bin_roads2 <- glmer(factor(proplt > 0) ~ skogkategori + treartgruppe9 + browspres_merged + helling + HOH + I(HOH^2) +  ac + (1|KOMNR),
family = binomial(),
data = browse9.6sc)

#       K     AICc Delta_AICc AICcWt Cum.Wt       LL
# Mod1 13 10902.98        0.0      1      1 -5438.47
# Mod2 12 10917.68       14.7      0      1 -5446.82
# Mod 1 = m2bin_roads

# beta
library(glmmTMB)
load("output/m3betaroad.rda")

m3betaroad2 <- glmmTMB(proplt ~ skogkategori + treartgruppe9 + ac + helling + HOH + I(HOH^2) + browspres_merged + (1|KOMNR),
            data = browse9.6scpos,
            family = beta_family())

#             dAIC df weight
# m3betaroad   0.0 13 0.5   
# m3betaroad2  0.0 13 0.5   
# > AIC(m3betaroad, m3betaroad2)
#             df       AIC
# m3betaroad  13 -603.6964
# m3betaroad2 13 -603.6964
# The original model is already without distance to roads...

```

```{r}
library(AICcmodavg)
candmods <- list(mhusabin, mhusabin_2)

glmmbeta_tab <- aictab(candmods, modnames = NULL,
                       second.ord = FALSE, nobs = NULL, sort = TRUE)

library(bbmle)
ICtab(m3betaroad, m3betaroad2, type = "AIC", weights = TRUE, delta = TRUE)
AIC(m3betaroad, m3betaroad2)

library(sjPlot)
tab_model(m16cbin_2, transform = NULL, 
          show.intercept = TRUE, show.est = TRUE, show.ci = 0.95, show.se = TRUE, show.std = NULL, show.p = TRUE, show.stat = FALSE, show.df = FALSE, show.zeroinf = FALSE, show.r2 = TRUE, show.icc = TRUE, show.adj.icc = FALSE, show.re.var = TRUE, show.aic = TRUE, show.dev = FALSE, show.obs = TRUE, p.threshold = c(0.05, 0.01, 0.001))


```

