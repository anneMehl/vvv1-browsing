---
title: "05_browsing_hurdle_remake"
author: "Anne"
date: "12/04/2021"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



########################################################################
## Generell test for zero inflation for browsing response variable ##
#######################################################################
```{r}
load("processdata/browse.rda")

library(ggplot2)
library(ggpubr)

ggplot(browse, aes(beitetrykk9)) +
  geom_histogram(fill = "#0073C2FF") +
  theme_pubclean()

ggplot(browse, aes(bt100)) +
  geom_histogram(fill = "#0073C2FF") +
  theme_pubclean()

str(browse$beitetrykk9)
summary(browse$beitetrykk9)



#### Test for zero-inflation

# Use glmmTMB package to run glm
library("glmmTMB")
m_test_zi <- glm(beitetrykk9 ~ disthus + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac, family = poisson, data = browse)

library("performance")
check_zeroinflation(m_test_zi)

# # Check for zero-inflation
# 
#    Observed zeros: 5681
#   Predicted zeros: 1
#             Ratio: 0.00
# 
# Model is underfitting zeros (probable zero-inflation).



```



##       BINARY - First part of hurdle model to account for zero inflation  ##

## Bin threshold distance to house

#### Load data house threshold
```{r}
load("processdata/browse_2021_02_01.rda")
names(browse)

browse_house <- browse

names(browse_house)

```


###### Scale variables if necessary
```{r}

browse_house$disthus <- scale(browse_house$disthus)
browse_house$distvei2 <- scale(browse_house$distvei2)

browse_house$tretetthet9 <- scale(browse_house$tretetthet9)
browse_house$helling <- scale(browse_house$helling)
browse_house$HOH <- scale(browse_house$HOH)
browse_house$moose_density <- scale(browse_house$moose_density)

browse_house$disthus_600 <- scale(browse_house$disthus_600)
browse_house$disthus_500 <- scale(browse_house$disthus_500)
browse_house$disthus_400 <- scale(browse_house$disthus_400)
browse_house$disthus_350 <- scale(browse_house$disthus_350)
browse_house$disthus_300 <- scale(browse_house$disthus_300)

browse_house$disthus_200 <- scale(browse_house$disthus_200)

browse_house$disthus_150 <- scale(browse_house$disthus_150)

summary(browse_house$disthus_200)
```


###### Checking for the threshold for disthus
```{r}
library(lme4)


bin_cuthouse1 <- glmer(factor(beitetrykk9 > 0) ~ disthus + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

bin_cuthouse2 <- glmer(factor(beitetrykk9 > 0) ~ disthus_600 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

bin_cuthouse3 <- glmer(factor(beitetrykk9 > 0) ~ disthus_500 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) 

bin_cuthouse4 <- glmer(factor(beitetrykk9 > 0) ~ disthus_400 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

bin_cuthouse5 <- glmer(factor(beitetrykk9 > 0) ~ disthus_350 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

bin_cuthouse6 <- glmer(factor(beitetrykk9 > 0) ~ disthus_300 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

bin_cuthouse7 <- glmer(factor(beitetrykk9 > 0) ~ disthus_200 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) # BEST

bin_cuthouse8 <- glmer(factor(beitetrykk9 > 0) ~ disthus_150 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

```

###### AIC selection threshold house
```{r}
library(AICcmodavg)

candmods_bin_cuthouse <- list(bin_cuthouse1, bin_cuthouse2, bin_cuthouse3, bin_cuthouse4, bin_cuthouse5, bin_cuthouse6, bin_cuthouse7, bin_cuthouse8)
aictab(candmods_bin_cuthouse, modnames = NULL,
                       second.ord = F, nobs = NULL, sort = TRUE)

# Model selection based on AICc:
#
#       K      AIC Delta_AIC AICWt Cum.Wt        LL
# 200 19 21508.86      0.00  0.66   0.66 -10735.43
# 150 19 21510.71      1.84  0.26   0.92 -10736.35
# 300 19 21513.22      4.35  0.07   1.00 -10737.61
# 350 19 21521.55     12.69  0.00   1.00 -10741.77
# 400 19 21528.51     19.65  0.00   1.00 -10745.26
# 500 19 21539.56     30.70  0.00   1.00 -10750.78
# 600 19 21550.45     41.59  0.00   1.00 -10756.23
# full 19 21581.44     72.57  0.00   1.00 -10771.72

```

###### Save browse_house dataset
```{r}
names(browse_house)
browse_house <- browse_house[, -c(16,18:20,22)]
names(browse_house)
browse_house$beite_bin <- ifelse(browse_house$beitetrykk9 == 0, 0, 1)

str(browse_house)
save(browse_house, file = "processdata/browse_house_2021_04_12.rda")



```





## Bin threshold distance to roads

#### Load data roads threshold
```{r}
load("processdata/browse_2021_04_15.rda")
names(browse)

browse_house <- browse

names(browse_house)

```


###### Scale variables if necessary
```{r}

browse_house$disthus <- scale(browse_house$disthus)
browse_house$distvei2 <- scale(browse_house$distvei2)

browse_house$tretetthet9 <- scale(browse_house$tretetthet9)
browse_house$helling <- scale(browse_house$helling)
browse_house$HOH <- scale(browse_house$HOH)
browse_house$moose_density <- scale(browse_house$moose_density)

browse_house$distvei_600 <- scale(browse_house$distvei_600)
browse_house$distvei_500 <- scale(browse_house$distvei_500)
browse_house$distvei_400 <- scale(browse_house$distvei_400)
browse_house$distvei_350 <- scale(browse_house$distvei_350)
browse_house$distvei_300 <- scale(browse_house$distvei_300)
browse_house$distvei_200 <- scale(browse_house$distvei_200)
browse_house$distvei_150 <- scale(browse_house$distvei_150)
browse_house$distvei_100 <- scale(browse_house$distvei_100)
browse_house$distvei_50 <- scale(browse_house$distvei_50)


summary(browse_house$distvei_200)

```


###### Checking for the threshold for distvei
```{r}
library(lme4)


bin_cutroad1 <- glmer(factor(beitetrykk9 > 0) ~ disthus + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

bin_cutroad2 <- glmer(factor(beitetrykk9 > 0) ~ distvei_600 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

bin_cutroad3 <- glmer(factor(beitetrykk9 > 0) ~ distvei_500 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) 

bin_cutroad4 <- glmer(factor(beitetrykk9 > 0) ~ distvei_400 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

bin_cutroad5 <- glmer(factor(beitetrykk9 > 0) ~ distvei_350 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

bin_cutroad6 <- glmer(factor(beitetrykk9 > 0) ~ distvei_300 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

bin_cutroad7 <- glmer(factor(beitetrykk9 > 0) ~ distvei_200 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) 

bin_cutroad8 <- glmer(factor(beitetrykk9 > 0) ~ distvei_150 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) # BEST

bin_cutroad9 <- glmer(factor(beitetrykk9 > 0) ~ distvei_100 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

bin_cutroad10 <- glmer(factor(beitetrykk9 > 0) ~ distvei_50 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

```

###### AIC selection threshold road
```{r}
library(AICcmodavg)

candmods_bin_cuthouse <- list(bin_cutroad1, bin_cutroad2, bin_cutroad3, bin_cutroad4, bin_cutroad5, bin_cutroad6, bin_cutroad7, bin_cutroad8, bin_cutroad9, bin_cutroad10)
aictab(candmods_bin_cuthouse, modnames = NULL,
                       second.ord = F, nobs = NULL, sort = TRUE)

# Model selection based on AICc:
#
#        K      AIC Delta_AIC AICWt Cum.Wt        LL
# Mod8  19 21434.18      0.00  0.98   0.98 -10698.09
# Mod7  19 21442.51      8.33  0.02   1.00 -10702.25
# Mod9  19 21453.97     19.79  0.00   1.00 -10707.99
# Mod6  19 21471.36     37.18  0.00   1.00 -10716.68
# Mod5  19 21482.42     48.24  0.00   1.00 -10722.21
# Mod10 19 21487.78     53.59  0.00   1.00 -10724.89
# Mod4  19 21493.68     59.49  0.00   1.00 -10727.84
# Mod3  19 21510.19     76.01  0.00   1.00 -10736.10
# Mod2  19 21525.13     90.94  0.00   1.00 -10743.56
# Mod1  19 21581.44    147.25  0.00   1.00 -10771.72

```


```{r}
browse_house$disthus_200 <- scale(browse_house$disthus_200)


distveilog <- glmer(factor(beitetrykk9 > 0) ~ disthus_200 + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) # Best

distveithresh <- glmer(factor(beitetrykk9 > 0) ~ disthus_200 + distvei_150 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)


candmods_bin_thresh <- list(distveilog, distveithresh)
aictab(candmods_bin_thresh, modnames = NULL,
                       second.ord = F, nobs = NULL, sort = TRUE)
#       K      AIC Delta_AIC AICWt Cum.Wt        LL
# Mod1 19 18511.50      0.00     1      1  -9236.75
# Mod2 19 21421.47   2909.98     0      1 -10691.74

```





## Bin models

#### Load data
```{r}
load("processdata/browse_house_2021_04_12.rda")
# load("processdata/browse_2021_04_15.rda")
str(browse_house)
names(browse_house)


```


#### Scale variables if necessary
```{r}

# browse_house$disthus <- scale(browse_house$disthus)
# browse_house$distvei2 <- scale(browse_house$distvei2)

browse_house$tretetthet9 <- scale(browse_house$tretetthet9)
browse_house$helling <- scale(browse_house$helling)
browse_house$HOH <- scale(browse_house$HOH)
browse_house$moose_density <- scale(browse_house$moose_density)

# browse_house$disthus_200 <- scale(browse_house$disthus_200)

# summary(browse_house$disthus_200)

```


#### Bin house models
```{r}
library(lme4)

browse_h_bin1 <- glmer(beite_bin ~ disthus_200 + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) 
summary(browse_h_bin1)

browse_h_bin2 <- glmer(beite_bin ~ log(disthus+1) + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)
summary(browse_h_bin2)

browse_h_bin3 <- glmer(beite_bin ~ log(distvei2+1) + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) 

browse_h_bin4 <- glmer(beite_bin ~ log(disthus+1) + log(distvei2+1) + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

browse_h_bin5 <- glmer(beite_bin ~ log(disthus+1) + log(distvei2+1) + treartgruppe9 + tretetthet9 + kant + helling + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)


browse_h_bin6 <- glmer(beite_bin ~ disthus_200 + log(distvei2+1) + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) 

browse_h_bin7 <- glmer(beite_bin ~ disthus_200 + log(distvei2+1) + treartgruppe9 + tretetthet9 + kant + helling + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

browse_h_bin8 <- glmer(beite_bin ~ disthus_200 + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) 

browse_h_bin9 <- glmer(beite_bin ~ log(disthus_200+1) + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) 

browse_h_bin9_500 <- glmer(beite_bin ~ log(disthus_500+1) + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)



## test for interactions ----
# hus*vei
browse_h_bin10 <- glmer(beite_bin ~ disthus_200*log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) 

# hus*skogskategori
browse_h_bin11 <- glmer(beite_bin ~ disthus_200*skogkategori + log(distvei2+1) + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house) # BEST 

# hus*treartgruppe
browse_h_bin12 <- glmer(beite_bin ~ disthus_200*treartgruppe9 + skogkategori + log(distvei2+1) + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)

browse_h_bin13 <- glmer(beite_bin ~ disthus_200*log(distvei2+1) + disthus_200*skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
family = binomial(),
data = browse_house)



```

#### AIC selection bin models
```{r}
library(AICcmodavg)

candmods_browse_house_bin <- list(browse_h_bin1, browse_h_bin2, browse_h_bin3, browse_h_bin4, browse_h_bin5)
aictab(candmods_browse_house_bin, modnames = NULL,
                       second.ord = FALSE, nobs = NULL, sort = TRUE)

#       K      AIC Delta_AIC AICWt Cum.Wt        LL
# Mod1 19 21483.80      0.00     1      1 -10722.90
# Mod2 19 21526.99     43.18     0      1 -10744.49
# Mod3 14 21537.21     53.41     0      1 -10754.61
# Mod4 15 21539.21     55.41     0      1 -10754.61
# Mod5 13 21581.24     97.44     0      1 -10777.62

candmods_browse_house_bin <- list(browse_h_bin2, browse_h_bin3, browse_h_bin4, browse_h_bin5)
aictab(candmods_browse_house_bin, modnames = NULL,
                       second.ord = FALSE, nobs = NULL, sort = TRUE)

#       K      AIC Delta_AIC AICWt Cum.Wt        LL
# Mod1 19 21526.99      0.00  0.99   0.99 -10744.49
# Mod2 14 21537.21     10.23  0.01   1.00 -10754.61
# Mod3 15 21539.21     12.23  0.00   1.00 -10754.61
# Mod4 13 21581.24     54.26  0.00   1.00 -10777.62

candmods_browse_house_bin <- list(browse_h_bin1, browse_h_bin6, browse_h_bin7, browse_h_bin8, browse_h_bin9)
aictab(candmods_browse_house_bin, modnames = NULL,
                       second.ord = FALSE, nobs = NULL, sort = TRUE)
#       K      AIC Delta_AIC AICWt Cum.Wt        LL
# Mod5 19 21483.15      0.00  0.58   0.58 -10722.58
# Mod1 19 21483.80      0.65  0.42   0.99 -10722.90
# Mod2 15 21491.83      8.68  0.01   1.00 -10730.92
# Mod4 17 21511.44     28.28  0.00   1.00 -10738.72
# Mod3 13 21527.95     44.80  0.00   1.00 -10750.98


candmods_browse_house_bin <- list(browse_h_bin1, browse_h_bin10, browse_h_bin11, browse_h_bin12, browse_h_bin13)
aictab(candmods_browse_house_bin, modnames = NULL,
                       second.ord = FALSE, nobs = NULL, sort = TRUE)
#       K      AIC Delta_AIC AICWt Cum.Wt        LL
# Mod5 24 21466.50      0.00  0.85   0.85 -10709.25
# Mod3 23 21470.01      3.51  0.15   0.99 -10712.01
# Mod2 20 21476.71     10.21  0.01   1.00 -10718.35
# Mod1 19 21483.80     17.30  0.00   1.00 -10722.90
# Mod4 21 21486.88     20.38  0.00   1.00 -10722.44
#
save(browse_h_bin1, file = "output/2021_04_18/browse_h_bin1.rda")
save(browse_h_bin10, file = "output/2021_04_18/browse_h_bin10.rda")
save(browse_h_bin11, file = "output/2021_04_18/browse_h_bin11.rda")
save(browse_h_bin12, file = "output/2021_04_18/browse_h_bin12.rda")
save(browse_h_bin13, file = "output/2021_04_18/browse_h_bin13.rda")

load("output/2021_04_18/browse_h_bin11.rda")
```

#### Summary bin house
```{r}
summary(browse_h_bin9)
summary(browse_h_bin9_500)
```



#### Plots bin house
```{r}
# library(effects)
# 
# plot(allEffects(rbrowse_h_bin)5)
# plot(effect("skogkategori", browse_h_bin5))


library(sjPlot)
plot_model(browse_h_bin9, type = "diag")
plot_model(browse_h_bin9, type = "eff")
plot_model(browse_h_bin9_500, type = "eff")
plot_model(browse_h_bin9, type = "est")

tab_model(browse_h_bin9_500, transform = NULL,
          show.intercept = TRUE, show.est = TRUE, show.ci = 0.95, p.threshold = c(0.05, 0.01, 0.001))


plot_model(browse_h_bin1, type = "eff", terms = "disthus_200")
plot_model(browse_h_bin1, type = "eff", terms = "distvei2 [0:600]")
plot_model(browse_h_bin10, type = "eff", terms = c("disthus_200", "distvei2"))
plot_model(browse_h_bin1, type = "eff", terms = "skogkategori")
plot_model(browse_h_bin11, type = "int")
plot_model(browse_h_bin1, type = "eff", terms = "treartgruppe9")
plot_model(browse_h_bin12, type = "int")

plot_model(browse_h_bin13, type = "eff", terms = c("disthus_200", "distvei2"))
plot_model(browse_h_bin13, type = "eff", terms = c("disthus_200", "skogkategori"))

```

#### Save bin house
```{r}
save(browse_h_bin9_500, file = "output/browse_2021_04_12/browse_h_bin9_500.rda")

```








##       ZERO-TRUNCATED - Second part of the hurdle, Beta  ##

## Load data house threshold
```{r}
load("processdata/browse_house.rda")


str(browse_house)
names(browse_house)
```


#### Prepare data set for second part of the hurdle threshold
```{r}
browse_house <- browse_house[browse_house$bt100 > 0, ]
str(browse_house)
summary(browse_house$bt100)

```


#### Scale variables if necessary
```{r}
browse_house$disthus <- scale(browse_house$disthus)
browse_house$distvei2 <- scale(browse_house$distvei2)

browse_house$tretetthet9 <- scale(browse_house$tretetthet9)
browse_house$helling <- scale(browse_house$helling)
browse_house$HOH <- scale(browse_house$HOH)
browse_house$moose_density <- scale(browse_house$moose_density)

browse_house$disthus_600 <- scale(browse_house$disthus_600)
browse_house$disthus_500 <- scale(browse_house$disthus_500)
browse_house$disthus_400 <- scale(browse_house$disthus_400)
browse_house$disthus_350 <- scale(browse_house$disthus_350)
browse_house$disthus_300 <- scale(browse_house$disthus_300)
browse_house$disthus_200 <- scale(browse_house$disthus_200)
browse_house$disthus_150 <- scale(browse_house$disthus_150)

summary(browse_house$disthus_600)
```

#### Checking for the threshold for disthus
```{r}
library(glmmTMB)

beta_cuthouse1 <- glmmTMB(bt100 ~ disthus + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cuthouse2 <- glmmTMB(bt100 ~ disthus_600 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cuthouse3 <- glmmTMB(bt100 ~ disthus_500 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cuthouse4 <- glmmTMB(bt100 ~ disthus_400 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cuthouse5 <- glmmTMB(bt100 ~ disthus_300 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cuthouse6 <- glmmTMB(bt100 ~ disthus_350 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cuthouse7 <- glmmTMB(bt100 ~ disthus_200 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family()) # BEST

beta_cuthouse8 <- glmmTMB(bt100 ~ disthus_150 + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

```

#### AIC selection threshold house
```{r}
library(AICcmodavg)

candmods_beta_cuthouse <- list(beta_cuthouse1, beta_cuthouse2, beta_cuthouse3, beta_cuthouse4, beta_cuthouse5, beta_cuthouse6, beta_cuthouse7, beta_cuthouse8)
# candmods_beta_cuthouse <- list(beta_cuthouse1, beta_cuthouse2, beta_cuthouse3)
aictab(candmods_beta_cuthouse, modnames = NULL,
                       second.ord = F, nobs = NULL, sort = TRUE)

# Model selection based on AICc:
# 
#       K      AIC Delta_AIC AICWt Cum.Wt      LL
# 200  20 -9735.49      0.00  0.92   0.92 4887.75
# 150  20 -9729.17      6.32  0.04   0.95 4884.59
# 300  20 -9729.17      6.33  0.04   0.99 4884.58
# 350  20 -9724.93     10.57  0.00   1.00 4882.46
# 400  20 -9722.46     13.03  0.00   1.00 4881.23
# 500  20 -9719.30     16.19  0.00   1.00 4879.65
# 600  20 -9714.78     20.72  0.00   1.00 4877.39
# full 20 -9702.39     33.10  0.00   1.00 4871.20

```





## Load data road threshold
```{r}
load("processdata/browse_2021_04_15.rda")

browse_house <- browse
str(browse_house)
names(browse_house)

```


#### Prepare data set for second part of the hurdle threshold
```{r}
browse_house <- browse_house[browse_house$bt100 > 0, ]
str(browse_house)
summary(browse_house$bt100)

```


#### Scale variables if necessary
```{r}
browse_house$disthus <- scale(browse_house$disthus)
# browse_house$distvei2 <- scale(browse_house$distvei2)

browse_house$tretetthet9 <- scale(browse_house$tretetthet9)
browse_house$helling <- scale(browse_house$helling)
browse_house$HOH <- scale(browse_house$HOH)
browse_house$moose_density <- scale(browse_house$moose_density)

browse_house$distvei_600 <- scale(browse_house$distvei_600)
browse_house$distvei_500 <- scale(browse_house$distvei_500)
browse_house$distvei_400 <- scale(browse_house$distvei_400)
browse_house$distvei_350 <- scale(browse_house$distvei_350)
browse_house$distvei_300 <- scale(browse_house$distvei_300)
browse_house$distvei_200 <- scale(browse_house$distvei_200)
browse_house$distvei_150 <- scale(browse_house$distvei_150)
browse_house$distvei_100 <- scale(browse_house$distvei_100)
browse_house$distvei_50 <- scale(browse_house$distvei_50)

summary(browse_house$disthus_600)
```

#### Checking for the threshold for distvei
```{r}
library(glmmTMB)

beta_cutroad1 <- glmmTMB(bt100 ~ disthus + distvei2 + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cutroad2 <- glmmTMB(bt100 ~ distvei_600 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cutroad3 <- glmmTMB(bt100 ~ distvei_500 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cutroad4 <- glmmTMB(bt100 ~ distvei_400 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cutroad5 <- glmmTMB(bt100 ~ distvei_300 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cutroad6 <- glmmTMB(bt100 ~ distvei_350 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

beta_cutroad7 <- glmmTMB(bt100 ~ distvei_200 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family()) # BEST

beta_cutroad8 <- glmmTMB(bt100 ~ distvei_150 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

```

#### AIC selection threshold road
```{r}
library(AICcmodavg)

candmods_beta_cut_road <- list(beta_cutroad1, beta_cutroad2, beta_cutroad3, beta_cutroad4, beta_cutroad5, beta_cutroad6, beta_cutroad7, beta_cutroad8)
# candmods_beta_cuthouse <- list(beta_cuthouse1, beta_cuthouse2, beta_cuthouse3)
aictab(candmods_beta_cut_road, modnames = NULL,
                       second.ord = F, nobs = NULL, sort = TRUE)

# Model selection based on AICc:
# 
#       K      AIC Delta_AIC AICWt Cum.Wt      LL
# Mod7 20 -9780.70      0.00  0.82   0.82 4910.35
# Mod8 20 -9777.44      3.26  0.16   0.98 4908.72
# Mod5 20 -9773.24      7.46  0.02   1.00 4906.62
# Mod6 20 -9769.91     10.79  0.00   1.00 4904.96
# Mod4 20 -9764.46     16.24  0.00   1.00 4902.23
# Mod3 20 -9752.98     27.72  0.00   1.00 4896.49
# Mod2 20 -9743.97     36.73  0.00   1.00 4891.98
# Mod1 20 -9701.83     78.87  0.00   1.00 4870.92

```



```{r}
browse_house$disthus_200 <- scale(browse_house$disthus_200)


distveilog_beta <-glmmTMB(bt100 ~ disthus_200 + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family()) 

distveithresh_beta <- glmmTMB(bt100 ~ distvei_200 + disthus + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family()) # Best


candmods_beta_thresh <- list(distveilog_beta, distveithresh_beta)
aictab(candmods_beta_thresh, modnames = NULL,
                       second.ord = F, nobs = NULL, sort = TRUE)
#       K      AIC Delta_AIC AICWt Cum.Wt      LL
# Mod2 20 -9780.70      0.00     1      1 4910.35
# Mod1 20 -9762.64     18.06     0      1 4901.32

save(distveilog_beta, file = "output/log_or_thresh/distveilog_beta.rda")
save(distveithresh_beta, file = "output/log_or_thresh/distveithresh_beta.rda")

library(sjPlot)
plot_model(distveithresh_beta, type = "eff", terms = "distvei_200")

```





## Beta house models

Prepare data set for second part of the hurdle
```{r}
load("processdata/browse_house_2021_04_12.rda")
browse_house <- browse_house[browse_house$bt100 > 0, ]
str(browse_house)
summary(browse_house$bt100)

```

#### Scale variables if necessary
```{r}
# browse_house$disthus <- scale(browse_house$disthus)
# browse_house$distvei2 <- scale(browse_house$distvei2)

browse_house$tretetthet9 <- scale(browse_house$tretetthet9)
browse_house$helling <- scale(browse_house$helling)
browse_house$HOH <- scale(browse_house$HOH)
browse_house$moose_density <- scale(browse_house$moose_density)

# browse_house$disthus_200 <- scale(browse_house$disthus_200)


# summary(browse_house$disthus_200)
```


#### Beta house models
```{r}
library(glmmTMB)

browse_h_beta1 <- glmmTMB(bt100 ~ disthus_200 + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())
summary(browse_h_beta1)

browse_h_beta2 <- glmmTMB(bt100 ~ log(disthus+1) + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

browse_h_beta3 <- glmmTMB(bt100 ~ disthus_200 + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

browse_h_beta4 <- glmmTMB(bt100 ~ log(disthus_200+1) + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family()) # BEST

# browse_h_beta4_500 <- glmmTMB(bt100 ~ log(disthus_500+1) + log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) +  ac + (1|KOMNR),
#             data = browse_house,
#             family = beta_family()) # same as browse_h_beta4, just run with disthus_500 to adjust to the other models


## Test for interactions:
## hus*vei
browse_h_beta5 <- glmmTMB(bt100 ~ disthus_200*log(distvei2+1) + skogkategori + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family()) # Cannot get sign.; Don't understand why I get the warning, when mod 1 run without. Warning messages:
# Warning messages:
# 1: In (function (start, objective, gradient = NULL, hessian = NULL,  :
#   NA/NaN function evaluation
# 2: In fitTMB(TMBStruc) :
#   Model convergence problem; non-positive-definite Hessian matrix. See vignette('troubleshooting')

## hus*skogskat
browse_h_beta6 <- glmmTMB(bt100 ~ disthus_200*skogkategori + log(distvei2+1) + treartgruppe9 + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family())

## hus*treart
browse_h_beta7 <- glmmTMB(bt100 ~ disthus_200*treartgruppe9 + skogkategori + log(distvei2+1) + tretetthet9 + kant + helling + HOH + I(HOH^2) + moose_density +  ac + (1|KOMNR),
            data = browse_house,
            family = beta_family()) # interaction not sign.
# Warning message:
# In (function (start, objective, gradient = NULL, hessian = NULL,  :
#   NA/NaN function evaluation
```


#### AIC selection beta models
```{r}
library(AICcmodavg)

candmods_browse_house_beta <- list(browse_h_beta1, browse_h_beta2, browse_h_beta3, browse_h_beta4)
aictab(candmods_browse_house_beta, modnames = NULL,
                       second.ord = F, nobs = NULL, sort = TRUE)

# Model selection based on AICc:
# 
#       K      AIC Delta_AIC AICWt Cum.Wt      LL
# Mod4 19 -9764.87      0.00  0.42   0.42 4901.43
# Mod3 19 -9764.46      0.41  0.34   0.76 4901.23
# Mod1 20 -9763.74      1.13  0.24   1.00 4901.87
# Mod2 20 -9745.95     18.92  0.00   1.00 4892.97


candmods_browse_house_beta <- list(browse_h_beta1, browse_h_beta5, browse_h_beta6, browse_h_beta7)
aictab(candmods_browse_house_beta, modnames = NULL,
                       second.ord = F, nobs = NULL, sort = TRUE)

save(browse_h_beta1, file = "output/2021_04_18/browse_h_beta1.rda")
save(browse_h_beta5, file = "output/2021_04_18/browse_h_beta5.rda")
save(browse_h_beta6, file = "output/2021_04_18/browse_h_beta6.rda")
save(browse_h_beta7, file = "output/2021_04_18/browse_h_beta7.rda")

```


#### Summary beta house
```{r}
summary(browse_h_beta4)
summary(browse_h_beta4_500)
```



#### Plots beta house
```{r}
# library(effects)
# plot(allEffects(rec_h_beta7))
# plot(effect("skogkategori", rec_h_beta7))

library(sjPlot)
plot_model(browse_h_beta4_500, type = "diag")
plot_model(browse_h_beta4_500, type = "eff")
plot_model(browse_h_beta4_500, type = "est")

tab_model(browse_h_beta4_500, transform = NULL,
          show.intercept = TRUE, show.est = TRUE, show.ci = 0.95, p.threshold = c(0.05, 0.01, 0.001))


plot_model(browse_h_beta1, type = "eff", terms = "disthus_200")
plot_model(browse_h_beta1, type = "eff", terms = "distvei2 [0:600]")
plot_model(browse_h_beta5, type = "eff", terms = c("disthus_200","distvei2"))
plot_model(browse_h_beta1, type = "eff", terms = "skogkategori")
plot_model(browse_h_beta6, type = "int")
plot_model(browse_h_beta1, type = "eff", terms = "treartgruppe9")
plot_model(browse_h_beta7, type = "int")

```


#### Save house beta model
```{r}
save(browse_h_beta4_500, file = "output/browse_2021_04_12/browse_h_beta4_500.rda")
```



