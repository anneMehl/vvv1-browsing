---
title: "browsing_pressure"
author: "anne"
date: "13 november 2018"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```





```{r}

load("processdata/browse_sub.rda")
load("processdata/browse_9.rda")
load("processdata/browse9bro.rda")
load("processdata/browse9bro_dist.rda")
load("processdata/browse_10.rda")
# load("processdata/broadhouse9.rda")
# load("processdata/broadhouse10.rda")

```



# gam

Models for general browsing pressure, not more than 1500m to a *public* road and where houses are not more than 2000m away
```{r}
m1 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1) + s(altitude) + foresttype, data = browse_sub, method = "REML")

# m1alt <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1) + s(altitude) + treegroup + foresttype, data = broad1500house1500, method = "REML")

m1alt2 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1) + s(altitude) + treegroup + foresttype, data = browse1500, method = "REML")

m1alt3 <- gam(browsingpressure ~ distroad1 + disthouse + landsdel + foresttype + edge + slope1 + altitude, data = broadhouse9, method = "REML")

# run the same model with obvious k, to see if the k is too low (as suggested in the summary), and then increase k
m1k <- gam(browsingpressure ~ s(distroad1, k = 26) + s(disthouse, k = 41) + s(slope1, k = 10) + s(altitude, k = 16) + treegroup + foresttype, data = broad1500house2000, method = "REML")

gam.check(m1alt3)
summary(m1alt3)

par(mfrow=c(4,2))
visreg(m1alt3)

```

```{r}
m2 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1) + treegroup + foresttype, data = broad1500house2000, method = "REML")

gam.check(m2)
summary(m2)

```

```{r}
m3 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + treegroup + foresttype, data = broad1500house2000, method = "REML")

gam.check(m1alt2)
summary(m3)

```

```{r}
m4 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + treegroup, data = broad1500house2000, method = "REML")

gam.check(m4)
summary(m4)

```

```{r}
m5 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + foresttype, data = broad1500house2000, method = "REML")

gam.check(m5)
summary(m5)

```

```{r}
m6 <- gam(browsingpressure ~ s(distroad1) + s(disthouse), data = broad1500house2000, method = "REML")

gam.check(m6)
summary(m6)

```

```{r}
m7 <- gam(browsingpressure ~ s(distroad1), data = broad1500house2000, method = "REML")
m7k <- gam(browsingpressure ~ s(distroad1, k = 19), data = broad1500house2000, method = "REML")

m7alt <- gam(browsingpressure ~ s(distroad1), data = browse1500, method = "REML")

gam.check(m7alt)
summary(m7)

```

```{r}
m8 <- gam(browsingpressure ~ s(disthouse), data = broad1500house2000, method = "REML")

gam.check(m8)
summary(m8)

```

```{r}
m9 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1), data = broad1500house2000, method = "REML")

gam.check(m9)
summary(m9)

```

```{r}
m10 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(altitude), data = broad1500house2000, method = "REML")

gam.check(m10)
summary(m10)

```

```{r}
m11 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1) + s(altitude), data = broad1500house2000, method = "REML")

gam.check(m11)
summary(m11)

```



Roadtype1 instead of distroad1 *--> worse AIC than m1 (with distroad1)*
```{r}
m12 <- gam(browsingpressure ~  s(disthouse) + roadtype1 + s(slope1) + s(altitude) + foresttype + treegroup, data = broad1500house2000, method = "REML")

gam.check(m12)
summary(m12)

```


Testing/ selection
```{r}
anova.gam(m1, m1k, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11)
anova(m1, m1k, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12, test = "F")
anova(m1, m1k, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12, test = "Chisq")
anova.gam(m1)
anova.gam(m1k)
anova.gam(m2)
anova.gam(m3)
anova.gam(m5)

AIC(m1, m1k, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12)
AIC(m1, m1alt3)
```



```{r}
summary(m1)
plot.gam(m5)
# summary(m1)$r.sq

# par(mfrow = c(2,2))
gam.check(m1alt3)

par(mfrow=c(1,2))
visreg(m7, scale = "response",
       ylab = "Browsing pressure %")
visreg(m7alt, scale = "response",
       ylab = "Browsing pressure %")

visreg(m1k, "treegroup",
       xlab = "Tree-group", ylab = "Browsing pressure %")

visreg(m1k, "treegroup", by = "distroad1", breaks = c(50, 100, 200, 500, 1000, 1500),
       ylab = "Browsing pressure %")
```










# (Generalized) Linear (mixed) models

---- !All models in the different sections (with different datasets) have the same names! ----

### with browse_9
```{r}

m1lm <- lm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse_9)
## m1lm fits data better than m2lm and m3lm.
# m2lm <- lm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + treartgruppe, data = browse_9)
# 
# m3lm <- lm(beitetrykkr ~ distvei3 + disthus + skogkategori + kant + helling + treartgruppe, data = browse_9)

m4lm <- lm(beitetrykkr ~ distvei3 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse_9)

m5lm <- lm(beitetrykkr ~ distvei1 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse_9)
m5lmN <- lm(beitetrykkr ~ distvei1 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse9bro)

m6lm <- lm(beitetrykkr ~ distvei1 + region + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse_9)

m7lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + skogkategori*distvei1, data = browse_9)

m7alm <- lm(beitetrykkr ~ distvei1 + disthus + skogkategori + treartgruppe + region + + kant + helling + hohkatb + skogkategori*distvei1, data = browse_9)

m8lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + treartgruppe*distvei1, data = browse_9)

m9lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + skogkategori*distvei1 + treartgruppe*distvei1, data = browse_9)

m10lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, data = browse_9)

m11lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + tretetthet*distvei1, data = browse_9)

m12lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + skogkategori*distvei1 + treartgruppe*distvei1, data = browse_9)



m1glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "poisson", 
            data = browse_9)

m2glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "quasipoisson", 
            data = browse_9)

m3glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "quasi", 
            data = browse_9)

# m2glm <- glm(beitetrykk ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "Gamma", 
#             data = browse_9)

m4glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "gaussian", 
            data = browse_9)

# m5glm <- glm(beitetrykk ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "inverse.gaussian", 
#             data = browse_9)

m5glm <- glm(beitetrykkr ~ distvei3 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "gaussian", 
            data = browse_9)

## weights on tretetthet makes the model very bad.
# m6glm <- glm(beitetrykkr ~ distvei3 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "gaussian", 
#             weights = tretetthet,
#             data = browse_9)
# 
# m7glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "poisson", 
#             weights = tretetthet,
#             data = browse_9)

m8glm <- glm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, 
            family = "quasipoisson", 
            data = browse_9)




m1mix <- glmer(beitetrykkr ~ scale(distvei3) + scale(disthus) + skogkategori + kant + scale(helling) + hohkatb + treartgruppe + (1|region), 
            data = browse_9,
            family = poisson())

m2mix <- lmer(beitetrykkr ~ distvei3 + disthus + skogkategori + kant + helling + hohkatb + treartgruppe + (1|region), data = browse_9)

m3mix <- lmer(beitetrykkr ~ distvei3 + disthus + skogkategori + kant + helling + hohkatb + treartgruppe + (1|landsdel), data = browse_9)




```

Testing fit and effect plots
```{r}


AIC(m4lm, m5lm, m6lm, m7lm, m8lm, m9lm, m10lm, m11lm, m12lm, m8glm)
AIC(m1glm, m2glm, m3glm, m4glm, m5glm, m6glm, m7glm, m8glm)
AIC(m7lm, m7alm)
AIC(m10lm, m11lm)


plot(allEffects(m1lm))
plot(allEffects(m4lm))
plot(allEffects(m5lm))
plot(allEffects(m7lm))
plot(allEffects(m10lm))
plot(allEffects(m12lm))


plot(allEffects(m1glm))
plot(allEffects(m2glm))
plot(allEffects(m3glm))
plot(allEffects(m4glm))
plot(allEffects(m7glm))



plot(predictorEffect("distvei3", m4lm))
plot(predictorEffect("distvei1", m5lm))
plot(Effect(c("distvei1","skogkategori"), m7lm))
plot(Effect(c("distvei1","skogkategori"), m12lm))
plot(Effect(c("distvei1","treartgruppe"), m12lm))


plot(allEffects(m2mix))
plot(allEffects(m3mix))



plot(m1lm)
plot(m10lm)

plot(m2glm) # quasipoisson (accounts for overdispersion)
plot(m4glm) # gaussian


summary(m1lm)
summary(m4lm)
summary(m5lm)
summary(m5lmN)
summary(m7lm)
summary(m10lm)

summary(m1glm)
summary(m2glm)
summary(m4glm)
summary(m5glm)
summary(m6glm)

summary(m1mix)
summary(m2mix)
summary(m3mix)

anova(m3mix)


hist(resid(m1lm))
hist(resid(m1glm))
hist(resid(m4glm))

hist(resid(m1mix))
hist(resid(m2mix))
hist(resid(m3mix))

```







### With browse9bro
```{r}

m1lm <- lm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse9bro)
## m1lm fits data better than m2lm and m3lm.
# m2lm <- lm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + treartgruppe, data = browse9bro)
# 
# m3lm <- lm(beitetrykkr ~ distvei3 + disthus + skogkategori + kant + helling + treartgruppe, data = browse9bro)

m4lm <- lm(beitetrykkr ~ distvei3 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse9bro)

m5lm <- lm(beitetrykkr ~ distvei1 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse9bro)
m5lmN <- lm(beitetrykkr ~ distvei1 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse9bro)

m6lm <- lm(beitetrykkr ~ distvei1 + region + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse9bro)

m7lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + skogkategori*distvei1, data = browse9bro)

m7alm <- lm(beitetrykkr ~ distvei1 + disthus + skogkategori + treartgruppe + region + + kant + helling + hohkatb + skogkategori*distvei1, data = browse9bro)

m8lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + treartgruppe*distvei1, data = browse9bro)

m9lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + skogkategori*distvei1 + treartgruppe*distvei1, data = browse9bro)


m10lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, data = browse9bro)


m11lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + tretetthet*distvei1, data = browse9bro)


m12lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + skogkategori*distvei1 + treartgruppe*distvei1, data = browse9bro)

m13lm <- lm(beitetrykkr ~ veitype1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, data = browse9bro)

m14lm <- lm(beitetrykkr ~ distvei1 + vegetasjon + treartgruppe + region + + kant + helling + hohkatb + tretetthet + vegetasjon*distvei1, data = browse9bro)





m1glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "poisson", 
            data = browse9bro)

m2glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "quasipoisson", 
            data = browse9bro)

m3glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "quasi", 
            data = browse9bro)

# m2glm <- glm(beitetrykk ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "Gamma", 
#             data = browse9bro)

m4glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "gaussian", 
            data = browse9bro)

# m5glm <- glm(beitetrykk ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "inverse.gaussian", 
#             data = browse9bro)

m5glm <- glm(beitetrykkr ~ distvei3 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "gaussian", 
            data = browse9bro)

## weights on tretetthet makes the model very bad.
# m6glm <- glm(beitetrykkr ~ distvei3 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "gaussian", 
#             weights = tretetthet,
#             data = browse9bro)
# 
# m7glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "poisson", 
#             weights = tretetthet,
#             data = browse9bro)

m8glm <- glm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, 
            family = "quasipoisson", 
            data = browse9bro)

m9glm <- glm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, 
            family = "gaussian", 
            data = browse9bro)






m1mix <- glmer(beitetrykkr ~ scale(distvei3) + scale(disthus) + skogkategori + kant + scale(helling) + hohkatb + treartgruppe + (1|region), 
            data = browse9bro,
            family = poisson())

m2mix <- lmer(beitetrykkr ~ distvei3 + disthus + skogkategori + kant + helling + hohkatb + treartgruppe + (1|region), data = browse9bro)

m3mix <- lmer(beitetrykkr ~ distvei3 + disthus + skogkategori + kant + helling + hohkatb + treartgruppe + (1|landsdel), data = browse9bro)

m4mix <- lmer(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + kant + helling + hohkatb + tretetthet + skogkategori*distvei1 + (1|region), data = browse9bro)


```

Testing fit and effect plots
```{r}


AIC(m1lm, m4lm, m5lm, m6lm, m7lm, m8lm, m9lm, m10lm, m11lm, m12lm)
AIC(m1glm, m2glm, m3glm, m4glm, m5glm, m8glm, m9glm)

AIC(m7lm, m7alm)
AIC(m10lm, m14lm)
AIC(m10lm, m9glm)

AIC(m1mix, m2mix, m3mix, m4mix)


plot(allEffects(m1lm))
plot(allEffects(m4lm))
plot(allEffects(m5lm))
plot(allEffects(m7lm))
plot(allEffects(m10lm))
plot(allEffects(m12lm))
plot(allEffects(m13lm))

plot(allEffects(m1glm))
plot(allEffects(m2glm))
plot(allEffects(m3glm))
plot(allEffects(m4glm))
plot(allEffects(m7glm))



plot(predictorEffect("distvei3", m4lm))
plot(predictorEffect("distvei1", m5lm))
plot(Effect(c("distvei1","skogkategori"), m7lm))
plot(Effect(c("distvei1","skogkategori"), m10lm))
plot(Effect(c("distvei1","skogkategori"), m12lm))
plot(Effect(c("distvei1","treartgruppe"), m12lm))


plot(allEffects(m2mix))
plot(allEffects(m3mix))
plot(allEffects(m4mix))


plot(m1lm)
plot(m10lm)

plot(m2glm) # quasipoisson (accounts for overdispersion)
plot(m4glm) # gaussian


summary(m1lm)
summary(m4lm)
summary(m5lm)
summary(m5lmN)
summary(m7lm)
summary(m10lm) # best
summary(m12lm) # (2nd best with 3 points difference)
summary(m13lm) # best, but logical?
summary(m14lm)

summary(m1glm)
summary(m2glm)
summary(m4glm)
summary(m5glm)
summary(m6glm)
summary(m9glm) # best


summary(m1mix)
summary(m2mix)
summary(m3mix)
summary(m4mix) # best

anova(m3mix)


hist(resid(m10lm))
hist(resid(m9glm))

hist(resid(m1mix))
hist(resid(m2mix))
hist(resid(m3mix))
hist(resid(m4mix))

```







### With browse9bro_dist

```{r}


m1lm <- lm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse9bro_dist)
## m1lm fits data better than m2lm and m3lm.
# m2lm <- lm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + treartgruppe, data = browse9bro_dist)
# 
# m3lm <- lm(beitetrykkr ~ distvei3 + disthus + skogkategori + kant + helling + treartgruppe, data = browse9bro_dist)

m4lm <- lm(beitetrykkr ~ distvei3 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse9bro_dist)

m5lm <- lm(beitetrykkr ~ distvei1 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse9bro_dist)

m6lm <- lm(beitetrykkr ~ distvei1 + region + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse9bro_dist)

m7lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + kant + helling + hohkatb + skogkategori*distvei1, data = browse9bro_dist)

m7alm <- lm(beitetrykkr ~ distvei1 + disthus + skogkategori + treartgruppe + region + kant + helling + hohkatb + skogkategori*distvei1, data = browse9bro_dist)

m8lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + kant + helling + hohkatb + treartgruppe*distvei1, data = browse9bro_dist)

m9lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + kant + helling + hohkatb + skogkategori*distvei1 + treartgruppe*distvei1, data = browse9bro_dist)


m10lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, data = browse9bro_dist)
m10alm <- lm(beitetrykkr ~ distvei1 + disthus+ skogkategori + treartgruppe + region + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, data = browse9bro_dist)


m11lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + kant + helling + hohkatb + tretetthet + tretetthet*distvei1, data = browse9bro_dist)


m12lm <- lm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + kant + helling + hohkatb + tretetthet + skogkategori*distvei1 + treartgruppe*distvei1, data = browse9bro_dist)
m12alm <- lm(beitetrykkr ~ distvei1 + disthus + skogkategori + treartgruppe + region + kant + helling + hohkatb + tretetthet + skogkategori*distvei1 + treartgruppe*distvei1, data = browse9bro_dist)


# m13lm <- lm(beitetrykkr ~ veitype1 + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, data = browse9bro_dist)
# m13alm <- lm(beitetrykkr ~ veitype1 + disthus + skogkategori + treartgruppe + region + + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, data = browse9bro_dist)

m14lm <- lm(beitetrykkr ~ distvei1 + vegetasjon + treartgruppe + region + + kant + helling + hohkatb + tretetthet + vegetasjon*distvei1, data = browse9bro_dist)

m15lm <- lm(beitetrykkr ~ distvei1 + disthus+ skogkategori + treartgruppe + region + kant + helling + hohkatb + tretetthet + tretetthet*distvei1, data = browse9bro_dist)

m16lm <- lm(beitetrykkr ~ distvei1 + disthus + skogkategori + treartgruppe + region + kant + helling + hohkatb + tretetthet + skogkategori*distvei1 + tretetthet*distvei1, data = browse9bro_dist)



m1glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "poisson", 
            data = browse9bro_dist)

m2glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "quasipoisson", 
            data = browse9bro_dist)

m3glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "quasi", 
            data = browse9bro_dist)

# m2glm <- glm(beitetrykk ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "Gamma", 
#             data = browse9bro_dist)

m4glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "gaussian", 
            data = browse9bro_dist)

# m5glm <- glm(beitetrykk ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "inverse.gaussian", 
#             data = browse9bro_dist)

m5glm <- glm(beitetrykkr ~ distvei3 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "gaussian", 
            data = browse9bro_dist)

## weights on tretetthet makes the model very bad.
# m6glm <- glm(beitetrykkr ~ distvei3 + disthus + region + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "gaussian", 
#             weights = tretetthet,
#             data = browse9bro_dist)
# 
# m7glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "poisson", 
#             weights = tretetthet,
#             data = browse9bro_dist)

m8glm <- glm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, 
            family = "quasipoisson", 
            data = browse9bro_dist)

m9glm <- glm(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + region + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, 
            family = "gaussian", 
            data = browse9bro_dist)
m9aglm <- glm(beitetrykkr ~ distvei1 + disthus + skogkategori + treartgruppe + region + kant + helling + hohkatb + tretetthet + skogkategori*distvei1, 
            family = "gaussian", 
            data = browse9bro_dist)





m1mix <- glmer(beitetrykkr ~ scale(distvei3) + scale(disthus) + skogkategori + kant + scale(helling) + hohkatb + treartgruppe + (1|region), 
            data = browse9bro_dist,
            family = poisson())

m2mix <- lmer(beitetrykkr ~ distvei3 + disthus + skogkategori + kant + helling + hohkatb + treartgruppe + (1|region), data = browse9bro_dist)

m3mix <- lmer(beitetrykkr ~ distvei3 + disthus + skogkategori + kant + helling + hohkatb + treartgruppe + (1|landsdel), data = browse9bro_dist)

m4mix <- lmer(beitetrykkr ~ distvei1 + skogkategori + treartgruppe + kant + helling + hohkatb + tretetthet + skogkategori*distvei1 + (1|region), data = browse9bro_dist)


```

Testing fit and effect plots
```{r}

AIC(m1lm, m4lm, m5lm, m6lm, m7lm, m7alm, m8lm, m9lm, m10lm, m10alm, m11lm, m12lm, m12alm, m14lm, m15lm, m16lm)
AIC(m1glm, m2glm, m3glm, m4glm, m5glm, m8glm, m9glm, m9aglm)

AIC(m7lm, m7alm)
AIC(m13lm, m13alm)
AIC(m10lm, m9glm)
AICc(m2glm, m8glm)
AIC(m10lm, m10alm)

AIC(m1mix, m2mix, m3mix, m4mix)


plot(allEffects(m1lm))
plot(allEffects(m4lm))
plot(allEffects(m5lm))
plot(allEffects(m7lm))
plot(allEffects(m10lm))
plot(allEffects(m10alm))
plot(allEffects(m12lm))
plot(allEffects(m12alm))
# plot(allEffects(m13lm))
# plot(allEffects(m13alm))
plot(allEffects(m15lm))
plot(allEffects(m16lm))

plot(allEffects(m1glm))
plot(allEffects(m2glm))
plot(allEffects(m3glm))
plot(allEffects(m4glm))
plot(allEffects(m7glm))
plot(allEffects(m9glm))
plot(allEffects(m9aglm))



plot(predictorEffect("distvei3", m4lm))
plot(predictorEffect("distvei1", m5lm))
plot(Effect(c("distvei1","skogkategori"), m7lm))
plot(Effect(c("distvei1","skogkategori"), m10lm))
plot(Effect(c("distvei1","skogkategori"), m12lm))
plot(Effect(c("distvei1","treartgruppe"), m12lm))


plot(allEffects(m2mix))
plot(allEffects(m3mix))
plot(allEffects(m4mix))


plot(m1lm)
plot(m10lm)

plot(m2glm) # quasipoisson (accounts for overdispersion)
plot(m9glm) # gaussian


summary(m1lm)
summary(m4lm)
summary(m5lm)
summary(m5lmN)
summary(m7lm)
summary(m10lm) # best
summary(m12lm) # 2nd best with 3 points difference
# summary(m13lm) # best, but logical?
summary(m14lm)

summary(m1glm)
summary(m2glm)
summary(m4glm)
summary(m5glm)
summary(m6glm)
summary(m9glm) # best


summary(m1mix)
summary(m2mix)
summary(m3mix)
summary(m4mix) # best

anova(m3mix)


hist(resid(m10lm))
hist(resid(m9glm))

hist(resid(m1mix))
hist(resid(m2mix))
hist(resid(m3mix))
hist(resid(m4mix))

```













