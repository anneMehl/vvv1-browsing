---
title: "browsing_pressure"
author: "anne"
date: "13 november 2018"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```





```{r}

load("processdata/browse_sub.rda")
load("processdata/browse_9.rda")
load("processdata/browse_10.rda")
# load("processdata/broadhouse9.rda")
# load("processdata/broadhouse10.rda")

```



## gam

Models for general browsing pressure, not more than 1500m to a *public* road and where houses are not more than 2000m away
```{r}
m1 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1) + s(altitude) + foresttype, data = browse_sub, method = "REML")

# m1alt <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1) + s(altitude) + treegroup + foresttype, data = broad1500house1500, method = "REML")

m1alt2 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1) + s(altitude) + treegroup + foresttype, data = browse1500, method = "REML")

m1alt3 <- gam(browsingpressure ~ distroad1 + disthouse + landsdel + foresttype + edge + slope1 + altitude, data = broadhouse9, method = "REML")

# run the same model with obvious k, to see if the k is too low (as suggested in the summary), and then increase k
m1k <- gam(browsingpressure ~ s(distroad1, k = 26) + s(disthouse, k = 41) + s(slope1, k = 10) + s(altitude, k = 16) + treegroup + foresttype, data = broad1500house2000, method = "REML")

gam.check(m1alt3)
summary(m1alt3)

par(mfrow=c(4,2))
visreg(m1alt3)

```

```{r}
m2 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1) + treegroup + foresttype, data = broad1500house2000, method = "REML")

gam.check(m2)
summary(m2)

```

```{r}
m3 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + treegroup + foresttype, data = broad1500house2000, method = "REML")

gam.check(m1alt2)
summary(m3)

```

```{r}
m4 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + treegroup, data = broad1500house2000, method = "REML")

gam.check(m4)
summary(m4)

```

```{r}
m5 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + foresttype, data = broad1500house2000, method = "REML")

gam.check(m5)
summary(m5)

```

```{r}
m6 <- gam(browsingpressure ~ s(distroad1) + s(disthouse), data = broad1500house2000, method = "REML")

gam.check(m6)
summary(m6)

```

```{r}
m7 <- gam(browsingpressure ~ s(distroad1), data = broad1500house2000, method = "REML")
m7k <- gam(browsingpressure ~ s(distroad1, k = 19), data = broad1500house2000, method = "REML")

m7alt <- gam(browsingpressure ~ s(distroad1), data = browse1500, method = "REML")

gam.check(m7alt)
summary(m7)

```

```{r}
m8 <- gam(browsingpressure ~ s(disthouse), data = broad1500house2000, method = "REML")

gam.check(m8)
summary(m8)

```

```{r}
m9 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1), data = broad1500house2000, method = "REML")

gam.check(m9)
summary(m9)

```

```{r}
m10 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(altitude), data = broad1500house2000, method = "REML")

gam.check(m10)
summary(m10)

```

```{r}
m11 <- gam(browsingpressure ~ s(distroad1) + s(disthouse) + s(slope1) + s(altitude), data = broad1500house2000, method = "REML")

gam.check(m11)
summary(m11)

```



Roadtype1 instead of distroad1 *--> worse AIC than m1 (with distroad1)*
```{r}
m12 <- gam(browsingpressure ~  s(disthouse) + roadtype1 + s(slope1) + s(altitude) + foresttype + treegroup, data = broad1500house2000, method = "REML")

gam.check(m12)
summary(m12)

```


Testing/ selection
```{r}
anova.gam(m1, m1k, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11)
anova(m1, m1k, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12, test = "F")
anova(m1, m1k, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12, test = "Chisq")
anova.gam(m1)
anova.gam(m1k)
anova.gam(m2)
anova.gam(m3)
anova.gam(m5)

AIC(m1, m1k, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12)
AIC(m1, m1alt3)
```



```{r}
summary(m1)
plot.gam(m5)
# summary(m1)$r.sq

# par(mfrow = c(2,2))
gam.check(m1alt3)

par(mfrow=c(1,2))
visreg(m7, scale = "response",
       ylab = "Browsing pressure %")
visreg(m7alt, scale = "response",
       ylab = "Browsing pressure %")

visreg(m1k, "treegroup",
       xlab = "Tree-group", ylab = "Browsing pressure %")

visreg(m1k, "treegroup", by = "distroad1", breaks = c(50, 100, 200, 500, 1000, 1500),
       ylab = "Browsing pressure %")
```










## (Generalized) Linear models

##### with browse_9
```{r}

m1lm <- lm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, data = browse_91)



m1glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "poisson", 
            data = browse_91)

m2glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "quasipoisson", 
            data = browse_91)

m3glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "quasi", 
            data = browse_91)

# m2glm <- glm(beitetrykk ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "Gamma", 
#             data = browse_91)

m4glm <- glm(beitetrykkr ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
            family = "gaussian", 
            data = browse_91)

# m5glm <- glm(beitetrykk ~ distvei3 + disthus + landsdel + skogkategori + kant + helling + hohkatb + treartgruppe, 
#             family = "inverse.gaussian", 
#             data = browse_91)






m1glmer <- glmer(beitetrykkr ~ scale(distvei3) + scale(disthus) + skogkategori + kant + scale(helling) + hohkatb + treartgruppe + (1|region), 
            data = browse_91,
            family = poisson())

m2lmer <- lmer(beitetrykkr ~ distvei3 + disthus + skogkategori + kant + helling + hohkatb + treartgruppe + (1|region), 
            data = browse_91)



AIC(m1lm, m1glm, m2glm, m3glm, m4glm)

plot(m1lm)
plot(m1glm)
plot(m4glm)


plot(tglm)
drop1(tglm2, test = "F")

plot(m1glmer)
plot(m2lmer)

summary(m1lm9)

summary(m1glm9)

summary(m1glmer)
summary(m2glmer)


hist(resid(m1glmer))
hist(resid(m2glmer))
hist(resid(m2lmer))

par(mfrow=c(4,2))
visreg(m1glm9)


```




















